{
  "version": 3,
  "sources": ["../src/image-editor.js"],
  "sourcesContent": ["function _regenerator() { /*! regenerator-runtime -- Copyright (c) 2014-present, Facebook, Inc. -- license (MIT): https://github.com/babel/babel/blob/main/packages/babel-helpers/LICENSE */ var e, t, r = \"function\" == typeof Symbol ? Symbol : {}, n = r.iterator || \"@@iterator\", o = r.toStringTag || \"@@toStringTag\"; function i(r, n, o, i) { var c = n && n.prototype instanceof Generator ? n : Generator, u = Object.create(c.prototype); return _regeneratorDefine2(u, \"_invoke\", function (r, n, o) { var i, c, u, f = 0, p = o || [], y = !1, G = { p: 0, n: 0, v: e, a: d, f: d.bind(e, 4), d: function d(t, r) { return i = t, c = 0, u = e, G.n = r, a; } }; function d(r, n) { for (c = r, u = n, t = 0; !y && f && !o && t < p.length; t++) { var o, i = p[t], d = G.p, l = i[2]; r > 3 ? (o = l === n) && (u = i[(c = i[4]) ? 5 : (c = 3, 3)], i[4] = i[5] = e) : i[0] <= d && ((o = r < 2 && d < i[1]) ? (c = 0, G.v = n, G.n = i[1]) : d < l && (o = r < 3 || i[0] > n || n > l) && (i[4] = r, i[5] = n, G.n = l, c = 0)); } if (o || r > 1) return a; throw y = !0, n; } return function (o, p, l) { if (f > 1) throw TypeError(\"Generator is already running\"); for (y && 1 === p && d(p, l), c = p, u = l; (t = c < 2 ? e : u) || !y;) { i || (c ? c < 3 ? (c > 1 && (G.n = -1), d(c, u)) : G.n = u : G.v = u); try { if (f = 2, i) { if (c || (o = \"next\"), t = i[o]) { if (!(t = t.call(i, u))) throw TypeError(\"iterator result is not an object\"); if (!t.done) return t; u = t.value, c < 2 && (c = 0); } else 1 === c && (t = i.return) && t.call(i), c < 2 && (u = TypeError(\"The iterator does not provide a '\" + o + \"' method\"), c = 1); i = e; } else if ((t = (y = G.n < 0) ? u : r.call(n, G)) !== a) break; } catch (t) { i = e, c = 1, u = t; } finally { f = 1; } } return { value: t, done: y }; }; }(r, o, i), !0), u; } var a = {}; function Generator() {} function GeneratorFunction() {} function GeneratorFunctionPrototype() {} t = Object.getPrototypeOf; var c = [][n] ? t(t([][n]())) : (_regeneratorDefine2(t = {}, n, function () { return this; }), t), u = GeneratorFunctionPrototype.prototype = Generator.prototype = Object.create(c); function f(e) { return Object.setPrototypeOf ? Object.setPrototypeOf(e, GeneratorFunctionPrototype) : (e.__proto__ = GeneratorFunctionPrototype, _regeneratorDefine2(e, o, \"GeneratorFunction\")), e.prototype = Object.create(u), e; } return GeneratorFunction.prototype = GeneratorFunctionPrototype, _regeneratorDefine2(u, \"constructor\", GeneratorFunctionPrototype), _regeneratorDefine2(GeneratorFunctionPrototype, \"constructor\", GeneratorFunction), GeneratorFunction.displayName = \"GeneratorFunction\", _regeneratorDefine2(GeneratorFunctionPrototype, o, \"GeneratorFunction\"), _regeneratorDefine2(u), _regeneratorDefine2(u, o, \"Generator\"), _regeneratorDefine2(u, n, function () { return this; }), _regeneratorDefine2(u, \"toString\", function () { return \"[object Generator]\"; }), (_regenerator = function _regenerator() { return { w: i, m: f }; })(); }\nfunction _regeneratorDefine2(e, r, n, t) { var i = Object.defineProperty; try { i({}, \"\", {}); } catch (e) { i = 0; } _regeneratorDefine2 = function _regeneratorDefine(e, r, n, t) { function o(r, n) { _regeneratorDefine2(e, r, function (e) { return this._invoke(r, n, e); }); } r ? i ? i(e, r, { value: n, enumerable: !t, configurable: !t, writable: !t }) : e[r] = n : (o(\"next\", 0), o(\"throw\", 1), o(\"return\", 2)); }, _regeneratorDefine2(e, r, n, t); }\nfunction asyncGeneratorStep(n, t, e, r, o, a, c) { try { var i = n[a](c), u = i.value; } catch (n) { return void e(n); } i.done ? t(u) : Promise.resolve(u).then(r, o); }\nfunction _asyncToGenerator(n) { return function () { var t = this, e = arguments; return new Promise(function (r, o) { var a = n.apply(t, e); function _next(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"next\", n); } function _throw(n) { asyncGeneratorStep(a, r, o, _next, _throw, \"throw\", n); } _next(void 0); }); }; }\nfunction ownKeys(e, r) { var t = Object.keys(e); if (Object.getOwnPropertySymbols) { var o = Object.getOwnPropertySymbols(e); r && (o = o.filter(function (r) { return Object.getOwnPropertyDescriptor(e, r).enumerable; })), t.push.apply(t, o); } return t; }\nfunction _objectSpread(e) { for (var r = 1; r < arguments.length; r++) { var t = null != arguments[r] ? arguments[r] : {}; r % 2 ? ownKeys(Object(t), !0).forEach(function (r) { _defineProperty(e, r, t[r]); }) : Object.getOwnPropertyDescriptors ? Object.defineProperties(e, Object.getOwnPropertyDescriptors(t)) : ownKeys(Object(t)).forEach(function (r) { Object.defineProperty(e, r, Object.getOwnPropertyDescriptor(t, r)); }); } return e; }\nfunction _defineProperty(e, r, t) { return (r = _toPropertyKey(r)) in e ? Object.defineProperty(e, r, { value: t, enumerable: !0, configurable: !0, writable: !0 }) : e[r] = t, e; }\nfunction _classCallCheck(a, n) { if (!(a instanceof n)) throw new TypeError(\"Cannot call a class as a function\"); }\nfunction _defineProperties(e, r) { for (var t = 0; t < r.length; t++) { var o = r[t]; o.enumerable = o.enumerable || !1, o.configurable = !0, \"value\" in o && (o.writable = !0), Object.defineProperty(e, _toPropertyKey(o.key), o); } }\nfunction _createClass(e, r, t) { return r && _defineProperties(e.prototype, r), t && _defineProperties(e, t), Object.defineProperty(e, \"prototype\", { writable: !1 }), e; }\nfunction _toPropertyKey(t) { var i = _toPrimitive(t, \"string\"); return \"symbol\" == _typeof(i) ? i : i + \"\"; }\nfunction _toPrimitive(t, r) { if (\"object\" != _typeof(t) || !t) return t; var e = t[Symbol.toPrimitive]; if (void 0 !== e) { var i = e.call(t, r || \"default\"); if (\"object\" != _typeof(i)) return i; throw new TypeError(\"@@toPrimitive must return a primitive value.\"); } return (\"string\" === r ? String : Number)(t); }\nfunction _typeof(o) { \"@babel/helpers - typeof\"; return _typeof = \"function\" == typeof Symbol && \"symbol\" == typeof Symbol.iterator ? function (o) { return typeof o; } : function (o) { return o && \"function\" == typeof Symbol && o.constructor === Symbol && o !== Symbol.prototype ? \"symbol\" : typeof o; }, _typeof(o); }\n/**\n * @file image-editor.js\n * @module image-editor\n * @version 1.1.1\n * @author Ben Situ\n * @license MIT\n * @description Lightweight canvas-based image editor with masking/transform/export support.\n *\n * This source file is free software, available under the MIT license.\n * It is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;\n * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.\n * See the license files for details.\n */\n\n(function (root, factory) {\n  if (typeof define === 'function' && define.amd) {\n    // AMD / RequireJS\n    define([], factory);\n  } else if ((typeof module === \"undefined\" ? \"undefined\" : _typeof(module)) === 'object' && module.exports) {\n    // CommonJS / Node / webpack (target=commonjs)\n    module.exports = factory();\n  } else {\n    // Browser normal <script> method, hanging to the global\n    root.ImageEditor = factory();\n  }\n})(typeof self !== 'undefined' ? self : this, function () {\n  'use strict';\n\n  /**\n   * ImageEditor\n   * \n   * A lightweight wrapper around fabric.js providing masking, scaling, rotation,\n   * merging/export helpers, and UI integrations for image editing.\n   *\n   * <b>Note:</b> Requires fabric.js (v5.x) to be loaded on the page before use.\n   *\n   * <pre>\n   * Example usage:\n   * const editor = new ImageEditor({ canvasWidth: 1024, canvasHeight: 768 });\n   * editor.init();\n   * </pre>\n   *\n   * @class ImageEditor\n   * @classdesc Fabric.js-based image editor with simple mask, transform, export and UI features.\n   *\n   * @param {Object} [options={}] - Customization options to override defaults.\n   * @param {number} [options.canvasWidth=800] - The initial canvas width in pixels.\n   * @param {number} [options.canvasHeight=600] - The initial canvas height in pixels.\n   * @param {string} [options.backgroundColor='#ffffff'] - The canvas background color.\n   * @param {number} [options.animationDuration=300] - Duration in ms for scale/rotate animations.\n   * @param {number} [options.minScale=0.1] - Minimum image scaling factor.\n   * @param {number} [options.maxScale=5.0] - Maximum image scaling factor.\n   * @param {number} [options.scaleStep=0.05] - Scale increment/decrement per step.\n   * @param {number} [options.rotationStep=90] - Rotation step in degrees.\n   * @param {boolean} [options.expandCanvasToImage=true] - If true, expands the canvas to fit image/mask.\n   * @param {boolean} [options.fitImageToCanvas=false] - If true, fits loaded image inside canvas.\n   * @param {boolean} [options.downsampleOnLoad=true] - Whether to downsample very large images on load.\n   * @param {number} [options.downsampleMaxWidth=4000] - Max width for downsampling.\n   * @param {number} [options.downsampleMaxHeight=3000] - Max height for downsampling.\n   * @param {number} [options.downsampleQuality=0.92] - JPEG quality for downsampling/export.\n   * @param {number} [options.exportMultiplier=1] - Scale output image by this multiplier on export.\n   * @param {boolean} [options.exportImageAreaByDefault=true] - Export only the image area (clipped to masks).\n   * @param {number} [options.defaultMaskWidth=50] - Default width of new mask rectangles.\n   * @param {number} [options.defaultMaskHeight=80] - Default height of new masks.\n   * @param {boolean} [options.maskRotatable=false] - If true, masks can be rotated.\n   * @param {boolean} [options.maskLabelOnSelect=true] - Show label on selected mask.\n   * @param {number} [options.maskLabelOffset=3] - Offset for mask labels from top-left corner.\n   * @param {string} [options.maskName='mask'] - Prefix for mask names/labels.\n   * @param {boolean} [options.showPlaceholder=true] - If true, shows placeholder when no image is loaded.\n   * @param {string|null} [options.initialImageBase64=null] - Base64 string to auto-load as initial image, if any.\n   * @param {string} [options.defaultDownloadFileName='edited_image.jpg'] - Default file name for downloads.\n   * @param {function} [options.onImageLoaded] - Optional callback to invoke after an image loads.\n   * \n   * @constructor\n   */\n  var ImageEditor = /*#__PURE__*/function () {\n    function ImageEditor() {\n      var options = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n      _classCallCheck(this, ImageEditor);\n      // Verify that fabric.js is present\n      this._fabricLoaded = typeof fabric !== 'undefined';\n      if (!this._fabricLoaded) {\n        console.error('fabric.js is not loaded. Please include fabric.js first. Initialization will be aborted.');\n      }\n      // Default options (can be overridden via ctor param)\n      this.options = _objectSpread({\n        canvasWidth: 800,\n        canvasHeight: 600,\n        backgroundColor: '#ffffff',\n        animationDuration: 300,\n        minScale: 0.1,\n        maxScale: 5.0,\n        scaleStep: 0.05,\n        rotationStep: 90,\n        expandCanvasToImage: true,\n        fitImageToCanvas: false,\n        downsampleOnLoad: true,\n        downsampleMaxWidth: 4000,\n        downsampleMaxHeight: 3000,\n        downsampleQuality: 0.92,\n        exportMultiplier: 1,\n        exportImageAreaByDefault: true,\n        defaultMaskWidth: 50,\n        defaultMaskHeight: 80,\n        maskRotatable: false,\n        maskLabelOnSelect: true,\n        maskLabelOffset: 3,\n        maskName: 'mask',\n        groupSelection: false,\n        showPlaceholder: true,\n        initialImageBase64: null,\n        // Provide a base64 'data:image/...' string here if you want auto-load\n\n        defaultDownloadFileName: 'edited_image.jpg'\n      }, options);\n      this.options.label = {\n        getText: function getText(mask, maskIndex) {\n          return mask.maskName;\n        },\n        textOptions: {\n          fontSize: 12,\n          fill: '#fff',\n          backgroundColor: 'rgba(0,0,0,0.7)',\n          padding: 2,\n          fontFamily: \"monospace\",\n          fontWeight: \"bold\",\n          selectable: false,\n          evented: false,\n          originX: 'left',\n          originY: 'top'\n        }\n      };\n      this.options.crop = {\n        minWidth: 100,\n        minHeight: 100,\n        padding: 10,\n        hideMasksDuringCrop: true,\n        preserveMasksAfterCrop: true,\n        allowRotationOfCropRect: false\n      };\n\n      // Runtime state\n      this.canvas = null;\n      this.canvasEl = null;\n      this.containerEl = null;\n      this.placeholderEl = null;\n      this.originalImage = null; // fabric.Image\n      this.baseImageScale = 1;\n      this.currentScale = 1;\n      this.currentRotation = 0;\n      this.maskCounter = 0;\n      this.isAnimating = false;\n      this.elements = {};\n      this.isImageLoadedToCanvas = false;\n      this.maxHistorySize = 50;\n      this._boundHandlers = {};\n      this._lastMaskInitialLeft = null;\n      this._lastMaskInitialTop = null;\n      this._lastMaskInitialWidth = null;\n      this._cropMode = false;\n      this._cropRect = null;\n      this._cropHandlers = [];\n      this.onImageLoaded = typeof options.onImageLoaded === 'function' ? options.onImageLoaded : null;\n      this.animQueue = new AnimationQueue();\n      this.historyManager = new HistoryManager(this.maxHistorySize);\n    }\n\n    /**\n     * Initializes the editor, binds to DOM elements, sets up event handlers,\n     * and (optionally) loads an initial image.\n     * Use this method to set up the editor UI before interacting with it.\n     *\n     * @param {Object} [idMap={}] - Optional mapping from logical element names to actual DOM element IDs.\n     *   Supported keys include: canvas, canvasContainer, imgPlaceholder, scaleRate, rotationLeftInput, rotationRightInput,\n     *   rotateLeftBtn, rotateRightBtn, addMaskBtn, removeMaskBtn, removeAllMasksBtn, mergeBtn, downloadBtn, maskList,\n     *   zoomInBtn, zoomOutBtn, resetBtn, imageInput. Unknown keys are ignored.\n     *\n     * @returns {void}\n     *\n     * @public\n     *\n     * @example\n     * editor.init({\n     *   canvas: 'myFabricCanvasId',\n     *   downloadBtn: 'myDownloadButtonId'\n     * });\n     */\n    return _createClass(ImageEditor, [{\n      key: \"init\",\n      value: function init() {\n        var idMap = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        if (!this._fabricLoaded) return;\n        var defaults = {\n          canvas: 'fabricCanvas',\n          canvasContainer: null,\n          // Pass an ID here if you have a scrollable viewport container\n          imgPlaceholder: 'imgPlaceholder',\n          scaleRate: 'scaleRate',\n          rotationLeftInput: 'rotationLeftInput',\n          rotationRightInput: 'rotationRightInput',\n          rotateLeftBtn: 'rotateLeftBtn',\n          rotateRightBtn: 'rotateRightBtn',\n          addMaskBtn: 'addMaskBtn',\n          removeMaskBtn: 'removeMaskBtn',\n          removeAllMasksBtn: 'removeAllMasksBtn',\n          mergeBtn: 'mergeBtn',\n          downloadBtn: 'downloadBtn',\n          maskList: 'maskList',\n          zoomInBtn: 'zoomInBtn',\n          zoomOutBtn: 'zoomOutBtn',\n          resetBtn: 'resetBtn',\n          undoBtn: 'undoBtn',\n          redoBtn: 'redoBtn',\n          imageInput: 'imageInput',\n          cropBtn: 'cropBtn',\n          applyCropBtn: 'applyCropBtn',\n          cancelCropBtn: 'cancelCropBtn'\n        };\n        this.elements = _objectSpread(_objectSpread({}, defaults), idMap);\n        this._initCanvas();\n        this._bindEvents();\n        this._updateInputs();\n        this._updateMaskList();\n        this._updateUI();\n\n        // Auto-load initial image if provided\n        if (this.options.initialImageBase64) {\n          this.loadImage(this.options.initialImageBase64);\n        } else {\n          this._updatePlaceholderStatus();\n        }\n      }\n\n      /**\n       * Canvas setup helpers\n       * @private\n       */\n    }, {\n      key: \"_initCanvas\",\n      value: function _initCanvas() {\n        var _this = this;\n        var canvasEl = document.getElementById(this.elements.canvas);\n        if (!canvasEl) throw new Error('Canvas is not found: ' + this.elements.canvas);\n        this.canvasEl = canvasEl;\n\n        // Decide which element acts as \"viewport\" (for width/height fallback)\n        if (this.elements.canvasContainer) {\n          var ce = document.getElementById(this.elements.canvasContainer);\n          this.containerEl = ce || canvasEl.parentElement;\n        } else {\n          this.containerEl = canvasEl.parentElement;\n        }\n        this.placeholderEl = document.getElementById(this.elements.imgPlaceholder) || null;\n\n        // Initial size \u2014 take container size if available\n        var initialW = this.options.canvasWidth;\n        var initialH = this.options.canvasHeight;\n        if (this.containerEl) {\n          var cw = Math.floor(this.containerEl.clientWidth);\n          var ch = Math.floor(this.containerEl.clientHeight);\n          if (cw > 0 && ch > 0) {\n            initialW = cw;\n            initialH = ch;\n          }\n        }\n        this.canvas = new fabric.Canvas(canvasEl, {\n          width: initialW,\n          height: initialH,\n          backgroundColor: this.options.backgroundColor,\n          selection: this.options.groupSelection,\n          preserveObjectStacking: true\n        });\n\n        // Fabric event wiring\n        this.canvas.on('selection:created', function (e) {\n          return _this._onSelectionChanged(e.selected);\n        });\n        this.canvas.on('selection:updated', function (e) {\n          return _this._onSelectionChanged(e.selected);\n        });\n        this.canvas.on('selection:cleared', function () {\n          return _this._onSelectionChanged([]);\n        });\n        this.canvas.on('object:moving', function (e) {\n          if (e.target && e.target.maskId) _this._syncMaskLabel(e.target);\n        });\n        this.canvas.on('object:scaling', function (e) {\n          if (e.target && e.target.maskId) _this._syncMaskLabel(e.target);\n        });\n        this.canvas.on('object:rotating', function (e) {\n          if (e.target && e.target.maskId) _this._syncMaskLabel(e.target);\n        });\n        this.canvas.on('object:modified', function (e) {\n          if (e.target && e.target.maskId) _this._syncMaskLabel(e.target);\n        });\n\n        // Avoid inline-element whitespace artefacts\n        this.canvasEl.style.display = 'block';\n      }\n\n      /** \n       * DOM / UI bindings\n       * @private\n       */\n    }, {\n      key: \"_bindEvents\",\n      value: function _bindEvents() {\n        var _this2 = this;\n        // Click anywhere on the upload area opens the native file dialog\n        this._bindIfExists('uploadArea', 'click', function () {\n          var _document$getElementB;\n          return (_document$getElementB = document.getElementById(_this2.elements.imageInput)) === null || _document$getElementB === void 0 ? void 0 : _document$getElementB.click();\n        });\n        // File-input change\n        var inputEl = document.getElementById(this.elements.imageInput);\n        if (inputEl) {\n          inputEl.addEventListener('change', function (e) {\n            var f = e.target.files && e.target.files[0];\n            if (f) _this2._loadImageFile(f);\n          });\n        }\n        // Zoom & reset\n        this._bindIfExists('zoomInBtn', 'click', function () {\n          return _this2.scaleImage(_this2.currentScale + _this2.options.scaleStep);\n        });\n        this._bindIfExists('zoomOutBtn', 'click', function () {\n          return _this2.scaleImage(_this2.currentScale - _this2.options.scaleStep);\n        });\n        this._bindIfExists('resetBtn', 'click', function () {\n          _this2.reset();\n        });\n        // Mask management\n        this._bindIfExists('addMaskBtn', 'click', function () {\n          return _this2.addMask();\n        });\n        this._bindIfExists('removeMaskBtn', 'click', function () {\n          return _this2.removeSelectedMask();\n        });\n        this._bindIfExists('removeAllMasksBtn', 'click', function () {\n          return _this2.removeAllMasks();\n        });\n        // Merge + download\n        this._bindIfExists('mergeBtn', 'click', function () {\n          return _this2.merge();\n        });\n        this._bindIfExists('downloadBtn', 'click', function () {\n          return _this2.downloadImage();\n        });\n        // Undo + Redo\n        this._bindIfExists('undoBtn', 'click', function () {\n          return _this2.undo();\n        });\n        this._bindIfExists('redoBtn', 'click', function () {\n          return _this2.redo();\n        });\n\n        // Rotation buttons (step can be overridden by two input fields)\n        var rotLeftBtn = document.getElementById(this.elements.rotateLeftBtn);\n        var rotRightBtn = document.getElementById(this.elements.rotateRightBtn);\n        if (rotLeftBtn) rotLeftBtn.addEventListener('click', function () {\n          var el = document.getElementById(_this2.elements.rotationLeftInput);\n          var step = _this2.options.rotationStep;\n          if (el) {\n            var p = parseFloat(el.value);\n            if (!isNaN(p)) step = p;\n          }\n          _this2.rotateImage(_this2.currentRotation - step);\n        });\n        if (rotRightBtn) rotRightBtn.addEventListener('click', function () {\n          var el = document.getElementById(_this2.elements.rotationRightInput);\n          var step = _this2.options.rotationStep;\n          if (el) {\n            var p = parseFloat(el.value);\n            if (!isNaN(p)) step = p;\n          }\n          _this2.rotateImage(_this2.currentRotation + step);\n        });\n\n        // Crop bindings (optional: bound only if element IDs exist in elements)\n        this._bindIfExists('cropBtn', 'click', function () {\n          return _this2.enterCropMode();\n        });\n        this._bindIfExists('applyCropBtn', 'click', function () {\n          _this2.applyCrop().catch(function (e) {\n            return console.error('applyCrop failed', e);\n          });\n        });\n        this._bindIfExists('cancelCropBtn', 'click', function () {\n          return _this2.cancelCrop();\n        });\n      }\n\n      /** \n       * Event binding element check\n       * \n       * @param {*} event \n       * @param {*} handler \n       * @param {*} key \n       * @private\n       */\n    }, {\n      key: \"_bindIfExists\",\n      value: function _bindIfExists(key, event, handler) {\n        var el = document.getElementById(this.elements[key]);\n        if (el) {\n          el.addEventListener(event, handler);\n          this._boundHandlers = this._boundHandlers || {};\n          if (!this._boundHandlers[key]) this._boundHandlers[key] = [];\n          this._boundHandlers[key].push({\n            event: event,\n            handler: handler\n          });\n        }\n      }\n\n      /** \n       * Image loading helpers\n       * \n       * @param {File} file \n       * @private\n       */\n    }, {\n      key: \"_loadImageFile\",\n      value: function _loadImageFile(file) {\n        var _this3 = this;\n        if (!file || !file.type.startsWith('image/')) return;\n        var reader = new FileReader();\n        reader.onload = function (e) {\n          return _this3.loadImage(e.target.result);\n        };\n        reader.onerror = function (e) {\n          console.error(\"[ImageEditor: fileReadError]\", e);\n        };\n        reader.readAsDataURL(file);\n      }\n\n      /**\n      * Load a base64 encoded image string into fabric.\n      * @async\n      * @param {String} base64 \n      */\n    }, {\n      key: \"loadImage\",\n      value: (function () {\n        var _loadImage = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee(base64) {\n          var _this4 = this;\n          var imgEl, loadSrc, needResize, ratio, tw, th;\n          return _regenerator().w(function (_context) {\n            while (1) switch (_context.n) {\n              case 0:\n                if (this._fabricLoaded) {\n                  _context.n = 1;\n                  break;\n                }\n                return _context.a(2);\n              case 1:\n                if (!(!base64 || typeof base64 !== 'string' || !base64.startsWith('data:image/'))) {\n                  _context.n = 2;\n                  break;\n                }\n                return _context.a(2);\n              case 2:\n                this._setPlaceholderVisible(false);\n                _context.n = 3;\n                return this._createImageElement(base64);\n              case 3:\n                imgEl = _context.v;\n                loadSrc = base64;\n                if (this.options.downsampleOnLoad) {\n                  needResize = imgEl.naturalWidth > this.options.downsampleMaxWidth || imgEl.naturalHeight > this.options.downsampleMaxHeight;\n                  if (needResize) {\n                    ratio = Math.min(this.options.downsampleMaxWidth / imgEl.naturalWidth, this.options.downsampleMaxHeight / imgEl.naturalHeight);\n                    tw = Math.round(imgEl.naturalWidth * ratio);\n                    th = Math.round(imgEl.naturalHeight * ratio);\n                    loadSrc = this._resampleImageToDataURL(imgEl, tw, th, this.options.downsampleQuality);\n                  }\n                }\n\n                // Create fabric.Image from URL\n                fabric.Image.fromURL(loadSrc, function (fimg) {\n                  _this4.canvas.discardActiveObject();\n                  _this4._hideAllMaskLabels();\n                  _this4.canvas.clear();\n                  _this4.canvas.setBackgroundColor(_this4.options.backgroundColor, _this4.canvas.renderAll.bind(_this4.canvas));\n                  fimg.set({\n                    originX: 'left',\n                    originY: 'top',\n                    selectable: false,\n                    evented: false\n                  });\n                  var imgW = fimg.width;\n                  var imgH = fimg.height;\n                  var minW = _this4.containerEl ? Math.floor(_this4.containerEl.clientWidth || _this4.options.canvasWidth) : _this4.options.canvasWidth;\n                  var minH = _this4.containerEl ? Math.floor(_this4.containerEl.clientHeight || _this4.options.canvasHeight) : _this4.options.canvasHeight;\n                  if (_this4.options.fitImageToCanvas) {\n                    // Fit into current canvas (shrink only)\n                    var cw = Math.max(_this4.options.canvasWidth, minW);\n                    var ch = Math.max(_this4.options.canvasHeight, minH);\n                    _this4._setCanvasSizeInt(cw, ch);\n                    var fitScale = Math.min(cw / imgW, ch / imgH, 1);\n                    fimg.set({\n                      left: (cw - imgW * fitScale) / 2,\n                      top: (ch - imgH * fitScale) / 2\n                    });\n                    fimg.scale(fitScale);\n                    _this4.baseImageScale = fimg.scaleX || 1;\n                  } else if (_this4.options.expandCanvasToImage) {\n                    // Expand canvas so that it fully contains the image\n                    var _cw = Math.max(minW, Math.floor(imgW));\n                    var _ch = Math.max(minH, Math.floor(imgH));\n                    _this4._setCanvasSizeInt(_cw, _ch);\n                    fimg.set({\n                      left: 0,\n                      top: 0\n                    });\n                    fimg.scale(1);\n                    _this4.baseImageScale = 1;\n                  } else {\n                    // Keep existing canvas size and center the image\n                    var _cw2 = Math.max(_this4.options.canvasWidth, minW);\n                    var _ch2 = Math.max(_this4.options.canvasHeight, minH);\n                    _this4._setCanvasSizeInt(_cw2, _ch2);\n                    var _fitScale = Math.min(_cw2 / imgW, _ch2 / imgH, 1);\n                    fimg.set({\n                      left: (_cw2 - imgW * _fitScale) / 2,\n                      top: (_ch2 - imgH * _fitScale) / 2\n                    });\n                    fimg.scale(_fitScale);\n                    _this4.baseImageScale = fimg.scaleX || 1;\n                  }\n                  // Put the image onto the canvas\n                  _this4.originalImage = fimg;\n                  _this4.canvas.add(fimg);\n                  _this4.canvas.sendToBack(fimg);\n\n                  // Reset mask placement memory\n                  _this4._lastMaskInitialLeft = null;\n                  _this4._lastMaskInitialTop = null;\n                  _this4._lastMaskInitialWidth = null;\n                  _this4.maskCounter = 0;\n                  _this4.currentScale = 1;\n                  _this4.currentRotation = 0;\n                  _this4._updateInputs();\n                  _this4._updateMaskList();\n                  _this4._updateUI();\n                  _this4.canvas.renderAll();\n                  _this4.isImageLoadedToCanvas = true;\n                  if (typeof _this4.onImageLoaded === 'function') {\n                    _this4.onImageLoaded();\n                  }\n                }, {\n                  crossOrigin: 'anonymous'\n                });\n              case 4:\n                return _context.a(2);\n            }\n          }, _callee, this);\n        }));\n        function loadImage(_x) {\n          return _loadImage.apply(this, arguments);\n        }\n        return loadImage;\n      }()\n      /**\n       * Checks whether there is a loaded image on the current canvas.\n       * @returns {boolean} true if loaded, false if not\n       */\n      )\n    }, {\n      key: \"isImageLoaded\",\n      value: function isImageLoaded() {\n        return !!(this.originalImage && this.originalImage instanceof fabric.Image && this.originalImage.width > 0 && this.originalImage.height > 0);\n      }\n\n      /**\n       * Creates an HTMLImageElement from a given data URL.\n       * \n       * @param {string} dataURL - A data URL representing the image (e.g., \"data:image/png;base64,...\").\n       * @returns {Promise<HTMLImageElement>} A promise that resolves to the created image element when loaded, or rejects on error.\n       * @private\n       */\n    }, {\n      key: \"_createImageElement\",\n      value: function _createImageElement(dataURL) {\n        return new Promise(function (res, rej) {\n          var img = new Image();\n          img.onload = function () {\n            img.onload = null;\n            img.onerror = null;\n            res(img);\n          };\n          img.onerror = function (e) {\n            img.onload = null;\n            img.onerror = null;\n            rej(e);\n          };\n          img.src = dataURL;\n        });\n      }\n\n      /**\n       * Resamples the given image element to a new width and height and returns the result as a JPEG data URL.\n       * \n       * @param {HTMLImageElement} imgEl - The image element to resample.\n       * @param {number} w - Target width (in pixels) for the resampled image.\n       * @param {number} h - Target height (in pixels) for the resampled image.\n       * @param {number} [quality=0.92] - JPEG image quality between 0 and 1 (optional, default 0.92).\n       * @returns {string} A data URL representing the resampled image as JPEG.\n       * @private\n       */\n    }, {\n      key: \"_resampleImageToDataURL\",\n      value: function _resampleImageToDataURL(imgEl, w, h) {\n        var quality = arguments.length > 3 && arguments[3] !== undefined ? arguments[3] : 0.92;\n        var oc = document.createElement('canvas');\n        oc.width = w;\n        oc.height = h;\n        var ctx = oc.getContext('2d');\n        ctx.drawImage(imgEl, 0, 0, imgEl.naturalWidth, imgEl.naturalHeight, 0, 0, w, h);\n        return oc.toDataURL('image/jpeg', quality);\n      }\n\n      /** \n       * Sets canvas size to integer width and height values to prevent scrollbars due to sub-pixel rendering.\n       * Also updates the corresponding style attributes.\n       * \n       * @param {number} w - Canvas width (in pixels).\n       * @param {number} h - Canvas height (in pixels).\n       * @private\n       */\n    }, {\n      key: \"_setCanvasSizeInt\",\n      value: function _setCanvasSizeInt(w, h) {\n        var iw = Math.max(1, Math.round(Number(w) || 1));\n        var ih = Math.max(1, Math.round(Number(h) || 1));\n        // Set fabric internal and also style attributes to keep DOM consistent\n        this.canvas.setWidth(iw);\n        this.canvas.setHeight(ih);\n        if (typeof this.canvas.calcOffset === 'function') this.canvas.calcOffset();\n        // Keep DOM element in sync (avoid fractional CSS pixels)\n        if (this.canvasEl) {\n          this.canvasEl.style.width = iw + 'px';\n          this.canvasEl.style.height = ih + 'px';\n          this.canvasEl.style.maxWidth = 'none';\n        }\n      }\n\n      /** \n       * Gets the top-left corner coordinates of the given object.\n       * Used for geometry calculations (e.g., scale, rotate).\n       * \n       * @param {Object} obj - The object for which to get the top-left coordinates. Should support setCoords and getCoords/getBoundingRect methods.\n       * @returns {{x: number, y: number}} The top-left corner point as an object with x and y properties.\n       * @private\n       */\n    }, {\n      key: \"_getObjectTopLeftPoint\",\n      value: function _getObjectTopLeftPoint(obj) {\n        if (!obj) return {\n          x: 0,\n          y: 0\n        };\n        obj.setCoords();\n        var coords = typeof obj.getCoords === 'function' ? obj.getCoords() : null;\n        if (coords && coords.length) return coords[0];\n        var br = obj.getBoundingRect(true, true);\n        return {\n          x: br.left,\n          y: br.top\n        };\n      }\n\n      /**\n       * Sets the object's origin at the specified origin point, keeping a reference point fixed in position.\n       * \n       * @param {Object} obj - The object to modify. Should support set, setPositionByOrigin, and setCoords.\n       * @param {string} originX - The new originX (\"left\", \"center\", \"right\", etc.).\n       * @param {string} originY - The new originY (\"top\", \"center\", \"bottom\", etc.).\n       * @param {{x: number, y: number}} refPoint - The point to keep fixed while setting the new origins.\n       * @private\n       */\n    }, {\n      key: \"_setObjectOriginKeepingPosition\",\n      value: function _setObjectOriginKeepingPosition(obj, originX, originY, refPoint) {\n        if (!obj || !refPoint || !obj.setPositionByOrigin) return;\n        obj.set({\n          originX: originX,\n          originY: originY\n        });\n        obj.setPositionByOrigin(refPoint, originX, originY);\n        obj.setCoords();\n      }\n\n      /**\n       * Moves the object so its bounding box aligns with the canvas's top-left corner (0, 0).\n       * \n       * @param {Object} obj - The object to align.\n       * @private\n       */\n    }, {\n      key: \"_alignObjectBoundingBoxToCanvasTopLeft\",\n      value: function _alignObjectBoundingBoxToCanvasTopLeft(obj) {\n        if (!obj) return;\n        obj.setCoords();\n        var br = obj.getBoundingRect(true, true);\n        var dx = br.left;\n        var dy = br.top;\n        obj.set({\n          left: (obj.left || 0) - dx,\n          top: (obj.top || 0) - dy\n        });\n        obj.setCoords();\n        this.canvas.renderAll();\n      }\n\n      /**\n       * Updates the canvas size to match the bounding box of the original image,\n       * ensuring that the canvas is always at least as large as its container.\n       * @private\n       */\n    }, {\n      key: \"_updateCanvasSizeToImageBounds\",\n      value: function _updateCanvasSizeToImageBounds() {\n        if (!this.originalImage) return;\n        this.originalImage.setCoords();\n        var br = this.originalImage.getBoundingRect(true, true);\n\n        // Container integer sizes\n        var containerW = this.containerEl ? Math.ceil(this.containerEl.clientWidth || 0) : 0;\n        var containerH = this.containerEl ? Math.ceil(this.containerEl.clientHeight || 0) : 0;\n\n        // If image smaller or equal than container in BOTH dims => keep canvas equal to container\n        if (containerW > 0 && containerH > 0 && br.width <= containerW && br.height <= containerH) {\n          this._setCanvasSizeInt(containerW, containerH);\n          return;\n        }\n\n        // Else canvas follows image bounding box but not smaller than container dims individually\n        var newW = Math.max(containerW || 0, Math.floor(br.width));\n        var newH = Math.max(containerH || 0, Math.floor(br.height));\n        this._setCanvasSizeInt(newW, newH);\n      }\n\n      /** \n       * Scales the original image by a given factor, with animation.\n       * Returns a promise that resolves when the scale animation is complete.\n       * @param {number} factor - The scaling factor (will be clamped between `options.minScale` and `options.maxScale`).\n       * @returns {Promise<void>} Promise that resolves once the scaling animation finishes.\n       * @public\n       */\n    }, {\n      key: \"scaleImage\",\n      value: function scaleImage(factor) {\n        var _this5 = this;\n        return this.animQueue.add(function () {\n          return _this5._scaleImageImpl(factor);\n        });\n      }\n\n      /** \n       * Scales the original image by a given factor, with animation.\n       * Returns a promise that resolves when the scale animation is complete.\n       * @param {number} factor - The scaling factor (will be clamped between `options.minScale` and `options.maxScale`).\n       * @returns {Promise<void>} Promise that resolves once the scaling animation finishes.\n       * @private\n       */\n    }, {\n      key: \"_scaleImageImpl\",\n      value: function _scaleImageImpl(factor) {\n        var _this6 = this;\n        if (!this.originalImage) return Promise.resolve();\n        if (this.isAnimating) return Promise.resolve();\n        factor = Math.max(this.options.minScale, Math.min(this.options.maxScale, factor));\n        this.currentScale = factor;\n        this.isAnimating = true;\n        this._updateUI();\n        var targetAbs = this.baseImageScale * factor;\n\n        // Scale around current top-left (recompute)\n        var topLeft = this._getObjectTopLeftPoint(this.originalImage);\n        this._setObjectOriginKeepingPosition(this.originalImage, 'left', 'top', topLeft);\n        var p1 = new Promise(function (res) {\n          _this6.originalImage.animate('scaleX', targetAbs, {\n            duration: _this6.options.animationDuration,\n            onChange: _this6.canvas.renderAll.bind(_this6.canvas),\n            onComplete: res\n          });\n        });\n        var p2 = new Promise(function (res) {\n          _this6.originalImage.animate('scaleY', targetAbs, {\n            duration: _this6.options.animationDuration,\n            onChange: _this6.canvas.renderAll.bind(_this6.canvas),\n            onComplete: res\n          });\n        });\n        return Promise.all([p1, p2]).then(function () {\n          _this6.originalImage.set({\n            scaleX: targetAbs,\n            scaleY: targetAbs\n          });\n          _this6.originalImage.setCoords();\n          if (_this6.options.expandCanvasToImage) _this6._updateCanvasSizeToImageBounds();\n          _this6._alignObjectBoundingBoxToCanvasTopLeft(_this6.originalImage);\n\n          // Sync mask labels\n          _this6.canvas.getObjects().forEach(function (o) {\n            if (o.maskId) _this6._syncMaskLabel(o);\n          });\n          _this6.isAnimating = false;\n          _this6._updateInputs();\n          _this6._updateUI();\n          _this6.saveState();\n        }).catch(function () {\n          _this6.isAnimating = false;\n          _this6._updateUI();\n        });\n      }\n\n      /** \n       * Rotates the original image by a given number of degrees, with animation.\n       * Returns a promise that resolves when the rotation animation is complete.\n       * @param {number} degrees - The angle in degrees to rotate the image.\n       * @returns {Promise<void>} Promise that resolves once the rotation animation finishes.\n       * @public\n       */\n    }, {\n      key: \"rotateImage\",\n      value: function rotateImage(deg) {\n        var _this7 = this;\n        return this.animQueue.add(function () {\n          return _this7._rotateImageImpl(deg);\n        });\n      }\n\n      /** \n       * Rotates the original image by a given number of degrees, with animation.\n       * Returns a promise that resolves when the rotation animation is complete.\n       * @param {number} degrees - The angle in degrees to rotate the image.\n       * @returns {Promise<void>} Promise that resolves once the rotation animation finishes.\n       * @private\n       */\n    }, {\n      key: \"_rotateImageImpl\",\n      value: function _rotateImageImpl(degrees) {\n        var _this8 = this;\n        if (!this.originalImage) return Promise.resolve();\n        if (this.isAnimating) return Promise.resolve();\n        if (isNaN(degrees)) return Promise.resolve();\n        this.currentRotation = degrees;\n        this.isAnimating = true;\n        this._updateUI();\n        var center = this.originalImage.getCenterPoint();\n        this._setObjectOriginKeepingPosition(this.originalImage, 'center', 'center', center);\n        var p = new Promise(function (res) {\n          _this8.originalImage.animate('angle', degrees, {\n            duration: _this8.options.animationDuration,\n            onChange: _this8.canvas.renderAll.bind(_this8.canvas),\n            onComplete: res\n          });\n        });\n        return p.then(function () {\n          _this8.originalImage.set('angle', degrees);\n          _this8.originalImage.setCoords();\n          if (_this8.options.expandCanvasToImage) _this8._updateCanvasSizeToImageBounds();\n          _this8._alignObjectBoundingBoxToCanvasTopLeft(_this8.originalImage);\n          var newTopLeft = _this8._getObjectTopLeftPoint(_this8.originalImage);\n          _this8._setObjectOriginKeepingPosition(_this8.originalImage, 'left', 'top', newTopLeft);\n\n          // Sync mask labels\n          _this8.canvas.getObjects().forEach(function (o) {\n            if (o.maskId) _this8._syncMaskLabel(o);\n          });\n          _this8.isAnimating = false;\n          _this8._updateInputs();\n          _this8._updateUI();\n          _this8.saveState();\n        }).catch(function () {\n          _this8.isAnimating = false;\n          _this8._updateUI();\n        });\n      }\n\n      /**\n       * Resets the image: scales to 1 and rotates to 0 degrees.\n       * @returns {Promise<void>} Promise that resolves when reset is complete.\n       */\n    }, {\n      key: \"reset\",\n      value: function reset() {\n        var _this9 = this;\n        if (!this.originalImage) return Promise.resolve();\n        return this.scaleImage(1).then(function () {\n          return _this9.rotateImage(0);\n        }).then(function () {\n          _this9.saveState();\n        }).catch(function (err) {\n          console.error('reset() failed', err);\n        });\n      }\n\n      /**\n       * Restores a canvas state that was previously stored by saveState().\n       * @param {string} jsonString - the JSON string returned by fabric.toJSON().\n       */\n    }, {\n      key: \"loadFromState\",\n      value: function loadFromState(jsonString) {\n        var _this0 = this;\n        if (!jsonString || !this.canvas) return;\n        try {\n          var json = typeof jsonString === 'string' ? JSON.parse(jsonString) : jsonString;\n          this.canvas.loadFromJSON(json, function () {\n            _this0._hideAllMaskLabels();\n            var objs = _this0.canvas.getObjects();\n            _this0.originalImage = objs.find(function (o) {\n              return o.type === 'image' && !o.maskId;\n            }) || null;\n            _this0.originalImage.set({\n              originX: 'left',\n              originY: 'top',\n              selectable: false,\n              evented: false,\n              hasControls: false,\n              hoverCursor: 'default'\n            });\n            _this0.canvas.sendToBack(_this0.originalImage);\n            var masks = objs.filter(function (o) {\n              return o.maskId;\n            });\n            _this0.maskCounter = masks.reduce(function (max, m) {\n              return Math.max(max, m.maskId);\n            }, 0);\n            _this0.canvas.renderAll();\n            _this0._updateMaskList();\n            _this0._updateUI();\n          });\n        } catch (e) {\n          console.error('loadFromState() failed', e);\n        }\n      }\n\n      /**\n       * Saves the current state of the canvas to history, storing any mask/raster label information.\n       */\n    }, {\n      key: \"saveState\",\n      value: function saveState() {\n        var _this1 = this;\n        if (!this.canvas) return;\n        var activeObj = this.canvas.getActiveObject();\n        this._hideAllMaskLabels();\n        try {\n          // request JSON including the custom flag 'isCropRect' so we can filter it out\n          var jsonObj = this.canvas.toJSON(['maskId', 'maskName', 'isCropRect']);\n          if (Array.isArray(jsonObj.objects)) {\n            // filter out crop-rect objects before stringifying\n            jsonObj.objects = jsonObj.objects.filter(function (o) {\n              return !o.isCropRect;\n            });\n          }\n          var after = JSON.stringify(jsonObj);\n          var before = this._lastSnapshot || after;\n          var executedOnce = false;\n          var cmd = new Command(function () {\n            if (executedOnce) {\n              _this1.loadFromState(after);\n            }\n            executedOnce = true;\n          }, function () {\n            _this1.loadFromState(before);\n          });\n          this.historyManager.execute(cmd);\n          this._lastSnapshot = after;\n          if (activeObj && activeObj.maskId) {\n            this._showLabelForMask(activeObj);\n          }\n          this._updateUI();\n        } catch (err) {\n          console.warn('saveState: failed to save canvas snapshot', err);\n        }\n      }\n\n      /**\n       * Undo the last state change, if possible.\n       */\n    }, {\n      key: \"undo\",\n      value: function undo() {\n        this.historyManager.undo();\n      }\n\n      /**\n       * Redo the next state change, if possible.\n       */\n    }, {\n      key: \"redo\",\n      value: function redo() {\n        this.historyManager.redo();\n      }\n\n      /** \n       * Adds a rectangular mask to the canvas.\n       * Mask placement and properties are determined by the provided config and instance options.\n       * Canvas and list UI are updated accordingly.\n       * @param {Object} [config={}] - Optional mask configuration overrides:\n       *   @param {string} [config.shape='rect'] - 'rect', 'circle', 'ellipse', 'polygon', ...\n       *   @param {Object|Array} [config.points] - Required for polygon: [{x, y}, ...] or [[x, y], ...]\n       *   @param {number|function} [config.width/height/rx/ry/radius] - Can be number or function(canvas, options) \n       *   @param {number|string|function} [config.left/top] - Absolute, %, or function\n       *   @param {number|string} [config.angle] - Rotation angle (degree)\n       *   @param {string} [config.color] - Fill color in CSS color format (default 'rgba(0,0,0,0.5)')\n       *   @param {number} [config.alpha] - Opacity, from 0 to 1 (default 0.5)\n       *   @param {boolean} [config.selectable=true]\n       *   @param {Object} [config.styles] - Custom styles (stroke, dashArray, etc)\n       *   @param {function} [config.onCreate] - Callback after mask created (receives Fabric object)\n       *   @param {function} [config.fabricGenerator] - (cfg) => new FabricObj\n       * @returns {fabric.Rect|null} The created mask object, or null if canvas is not available.\n       * @public\n       */\n    }, {\n      key: \"addMask\",\n      value: function addMask() {\n        var _this10 = this;\n        var config = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : {};\n        if (!this.canvas) return null;\n        var shapeType = config.shape || 'rect';\n        // Default config\n        var cfg = _objectSpread({\n          shape: shapeType,\n          width: this.options.defaultMaskWidth,\n          height: this.options.defaultMaskHeight,\n          color: 'rgba(0,0,0,0.5)',\n          alpha: 0.5,\n          gap: 5,\n          left: undefined,\n          top: undefined,\n          angle: 0,\n          selectable: true\n        }, config);\n\n        // Always start placement relative to canvas left/top.\n        var firstOffset = 10;\n        var left = firstOffset;\n        var top = firstOffset;\n        var resolveValue = function resolveValue(val, fallback) {\n          if (typeof val === 'function') return val(_this10.canvas, _this10.options); // This context is this of addMask\n          if (typeof val === 'string' && val.endsWith('%')) {\n            var percent = parseFloat(val) / 100;\n            return Math.floor((_this10.canvas ? _this10.canvas.getWidth() : 0) * percent);\n          }\n          return val != null ? val : fallback;\n        };\n        if (cfg.left === undefined && this._lastMask) {\n          var _prev$top;\n          var prev = this._lastMask;\n          var prevRight = prev.left;\n          if (prev.getScaledWidth) {\n            prevRight += prev.getScaledWidth();\n          } else if (prev.width) {\n            var _prev$scaleX;\n            prevRight += prev.width * ((_prev$scaleX = prev.scaleX) !== null && _prev$scaleX !== void 0 ? _prev$scaleX : 1);\n          }\n          left = Math.round(prevRight + cfg.gap);\n          top = (_prev$top = prev.top) !== null && _prev$top !== void 0 ? _prev$top : firstOffset;\n        } else {\n          left = resolveValue(cfg.left, firstOffset);\n          top = resolveValue(cfg.top, firstOffset);\n        }\n        cfg.width = resolveValue(cfg.width, this.options.defaultMaskWidth);\n        cfg.height = resolveValue(cfg.height, this.options.defaultMaskHeight);\n\n        // If expandCanvasToImage mode, ensure canvas large enough to hold mask initial placement\n        if (this.options.expandCanvasToImage && shapeType === 'rect') {\n          var requiredW = Math.ceil(left + cfg.width + 10);\n          var requiredH = Math.ceil(top + cfg.height + 10);\n          var minW = this.containerEl ? Math.floor(this.containerEl.clientWidth || 0) : 0;\n          var minH = this.containerEl ? Math.floor(this.containerEl.clientHeight || 0) : 0;\n          var newW = Math.max(this.canvas.getWidth(), minW, requiredW);\n          var newH = Math.max(this.canvas.getHeight(), minH, requiredH);\n          this._setCanvasSizeInt(newW, newH);\n        }\n        var mask;\n        if (typeof cfg.fabricGenerator === 'function') {\n          mask = cfg.fabricGenerator(cfg, this.canvas, this.options);\n        } else {\n          switch (shapeType) {\n            case 'circle':\n              mask = new fabric.Circle(_objectSpread({\n                left: left,\n                top: top,\n                radius: resolveValue(cfg.radius, Math.min(cfg.width, cfg.height) / 2),\n                fill: cfg.color,\n                opacity: cfg.alpha,\n                angle: cfg.angle\n              }, cfg.styles));\n              break;\n            case 'ellipse':\n              mask = new fabric.Ellipse(_objectSpread({\n                left: left,\n                top: top,\n                rx: resolveValue(cfg.rx, cfg.width / 2),\n                ry: resolveValue(cfg.ry, cfg.height / 2),\n                fill: cfg.color,\n                opacity: cfg.alpha,\n                angle: cfg.angle\n              }, cfg.styles));\n              break;\n            case 'polygon':\n              var polyPoints = cfg.points || [];\n              if (Array.isArray(polyPoints) && polyPoints.length && _typeof(polyPoints[0]) === 'object') {\n                // Ensure numeric {x,y} objects for fabric.Polygon\n                polyPoints = polyPoints.map(function (pt) {\n                  return {\n                    x: Number(pt.x),\n                    y: Number(pt.y)\n                  };\n                });\n              }\n              mask = new fabric.Polygon(polyPoints, _objectSpread({\n                left: left,\n                top: top,\n                fill: cfg.color,\n                opacity: cfg.alpha,\n                angle: cfg.angle\n              }, cfg.styles));\n              break;\n            case 'rect':\n            default:\n              mask = new fabric.Rect(_objectSpread({\n                left: left,\n                top: top,\n                width: resolveValue(cfg.width, this.options.defaultMaskWidth),\n                height: resolveValue(cfg.height, this.options.defaultMaskHeight),\n                fill: cfg.color,\n                opacity: cfg.alpha,\n                angle: cfg.angle,\n                rx: cfg.rx,\n                // Rounded Corners\n                ry: cfg.ry\n              }, cfg.styles));\n          }\n        }\n        mask.selectable = cfg.selectable !== false;\n        mask.hasControls = 'hasControls' in cfg ? cfg.hasControls : true;\n        mask.lockRotation = !this.options.maskRotatable;\n        mask.borderColor = cfg.borderColor || 'red';\n        mask.cornerColor = cfg.cornerColor || 'black';\n        mask.cornerSize = cfg.cornerSize || 8;\n        mask.transparentCorners = 'transparentCorners' in cfg ? cfg.transparentCorners : false;\n        mask.stroke = cfg.styles && cfg.styles.stroke || '#ccc';\n        mask.strokeWidth = cfg.styles && cfg.styles.strokeWidth || 1;\n        mask.strokeUniform = 'strokeUniform' in cfg ? cfg.strokeUniform : true;\n        if (cfg.styles && cfg.styles.strokeDashArray) mask.strokeDashArray = cfg.styles.strokeDashArray;\n        mask.originalAlpha = cfg.alpha;\n        var normalStyle = {\n          stroke: mask.stroke,\n          strokeWidth: mask.strokeWidth,\n          opacity: mask.originalAlpha\n        };\n        var hoverStyle = {\n          stroke: '#ff5500',\n          strokeWidth: 2,\n          opacity: Math.min(mask.originalAlpha + 0.2, 1)\n        };\n        mask.on('mouseover', function () {\n          mask.set(hoverStyle);\n          mask.canvas.requestRenderAll();\n        });\n        mask.on('mouseout', function () {\n          mask.set(normalStyle);\n          mask.canvas.requestRenderAll();\n        });\n\n        // Remember initial for next one\n        this._lastMaskInitialLeft = left;\n        this._lastMaskInitialTop = top;\n        this._lastMaskInitialWidth = resolveValue(cfg.width, this.options.defaultMaskWidth);\n        mask.maskId = ++this.maskCounter;\n        mask.maskName = \"\".concat(this.options.maskName).concat(mask.maskId);\n        this._lastMask = mask;\n        this.canvas.add(mask);\n        this.canvas.bringToFront(mask);\n        if (cfg.selectable) this.canvas.setActiveObject(mask);\n        this._onSelectionChanged([mask]);\n        this._updateMaskList();\n        this._updateUI();\n        this.canvas.renderAll();\n        this.saveState();\n        if (typeof cfg.onCreate === 'function') cfg.onCreate(mask, this.canvas);\n        return mask;\n      }\n\n      /**\n       * Removes the currently selected mask from the canvas, if any.\n       * The associated label is also removed. UI and mask list are updated.\n       */\n    }, {\n      key: \"removeSelectedMask\",\n      value: function removeSelectedMask() {\n        var active = this.canvas.getActiveObject();\n        if (!active || !active.maskId) return;\n        this._removeLabelForMask(active);\n        this.canvas.remove(active);\n        this.canvas.discardActiveObject();\n        this._updateMaskList();\n        this._updateUI();\n        this.canvas.renderAll();\n        this.saveState();\n      }\n\n      /**\n       * Removes all masks from the canvas, including their labels.\n       * UI and internal mask placement memory are reset.\n       */\n    }, {\n      key: \"removeAllMasks\",\n      value: function removeAllMasks() {\n        var _this11 = this;\n        var masks = this.canvas.getObjects().filter(function (o) {\n          return o.maskId;\n        });\n        masks.forEach(function (m) {\n          return _this11._removeLabelForMask(m);\n        });\n        masks.forEach(function (m) {\n          return _this11.canvas.remove(m);\n        });\n        this.canvas.discardActiveObject();\n        this._lastMaskInitialLeft = null;\n        this._lastMaskInitialTop = null;\n        this._lastMaskInitialWidth = null;\n        this._updateMaskList();\n        this._updateUI();\n        this.canvas.renderAll();\n        this.saveState();\n      }\n\n      /**\n       * Removes the label associated with the specified mask object, if it exists.\n       * \n       * @param {fabric.Object} mask - The mask object whose label should be removed.\n       * @private\n       */\n    }, {\n      key: \"_removeLabelForMask\",\n      value: function _removeLabelForMask(mask) {\n        if (!mask || !this.canvas) return;\n        if (mask.__label) {\n          try {\n            var objs = this.canvas.getObjects();\n            if (objs.includes(mask.__label)) {\n              this.canvas.remove(mask.__label);\n            }\n          } catch (e) {/* ignore */}\n          try {\n            delete mask.__label;\n          } catch (e) {}\n        }\n      }\n\n      /**\n       * Creates and adds a custom label (fabric.Text or fabric.IText) for the mask.\n       * The label is default bound to the top-left of the mask and managed as a non-interactive overlay.\n       * \n       * @param {fabric.Object} mask - The mask to create a label for.\n       * @private\n       */\n    }, {\n      key: \"_createLabelForMask\",\n      value: function _createLabelForMask(mask) {\n        if (!mask || !this.options.maskLabelOnSelect) return;\n        this._removeLabelForMask(mask);\n        var textObj = null;\n        if (this.options.label && typeof this.options.label.create === 'function') {\n          textObj = this.options.label.create(mask, fabric);\n        }\n        if (!textObj) {\n          var txt = mask.maskName; // Default\n          var textOptions = {\n            left: 0,\n            top: 0,\n            fontSize: 12,\n            fill: '#fff',\n            backgroundColor: 'rgba(0,0,0,0.7)',\n            selectable: false,\n            evented: false,\n            padding: 2,\n            originX: 'left',\n            originY: 'top'\n          };\n          if (this.options.label) {\n            if (typeof this.options.label.getText === 'function') {\n              txt = this.options.label.getText(mask, this.maskCounter);\n            }\n            // Merge external styles\n            if (this.options.label.textOptions) {\n              Object.assign(textOptions, this.options.label.textOptions);\n            }\n          }\n          textObj = new fabric.Text(txt, textOptions);\n        }\n        textObj.maskLabel = true;\n        mask.__label = textObj;\n        this.canvas.add(textObj);\n        this.canvas.bringToFront(textObj);\n        this._syncMaskLabel(mask);\n      }\n\n      /**\n       * Hides (removes) all mask labels from the canvas.\n       * Internal label references on mask objects are also deleted.\n       * @private\n       */\n    }, {\n      key: \"_hideAllMaskLabels\",\n      value: function _hideAllMaskLabels() {\n        var _this12 = this;\n        if (!this.canvas) return;\n        var objs = this.canvas.getObjects();\n        var labels = objs.filter(function (o) {\n          return o.maskLabel;\n        });\n        labels.forEach(function (l) {\n          try {\n            if (objs.includes(l)) _this12.canvas.remove(l);\n          } catch (e) {}\n        });\n        objs.forEach(function (o) {\n          if (o.maskId && o.__label) {\n            try {\n              delete o.__label;\n            } catch (e) {}\n          }\n        });\n      }\n\n      /**\n       * Synchronizes the position, angle, and visibility of the mask's label so that it appears properly above the mask.\n       * \n       * @param {fabric.Object} mask - The mask whose label should be repositioned.\n       * @private\n       */\n    }, {\n      key: \"_syncMaskLabel\",\n      value: function _syncMaskLabel(mask) {\n        var _this$options$maskLab;\n        if (!mask) return;\n        if (!this.options.maskLabelOnSelect) return;\n        if (!mask.__label) return;\n        var coords = mask.getCoords ? mask.getCoords() : null;\n        if (!coords || coords.length < 4) return;\n        var tl = coords[0];\n        var center = mask.getCenterPoint();\n        var vx = center.x - tl.x;\n        var vy = center.y - tl.y;\n        var dist = Math.sqrt(vx * vx + vy * vy) || 1;\n        var ux = vx / dist;\n        var uy = vy / dist;\n        var offset = Math.max(0, (_this$options$maskLab = this.options.maskLabelOffset) !== null && _this$options$maskLab !== void 0 ? _this$options$maskLab : 3);\n        var px = tl.x + ux * offset;\n        var py = tl.y + uy * offset;\n        mask.__label.set({\n          left: Math.round(px),\n          top: Math.round(py),\n          angle: mask.angle || 0,\n          originX: 'left',\n          originY: 'top',\n          visible: true\n        });\n        mask.__label.setCoords();\n        this.canvas.renderAll();\n      }\n\n      /**\n       * Shows the label for the given mask, creating it if necessary and synchronizing its position.\n       * \n       * @param {fabric.Object} mask - The mask whose label should be shown.\n       * @private\n       */\n    }, {\n      key: \"_showLabelForMask\",\n      value: function _showLabelForMask(mask) {\n        if (!mask) return;\n        if (!this.options.maskLabelOnSelect) return;\n        if (!mask.__label) this._createLabelForMask(mask);\n        mask.__label.visible = true;\n        this._syncMaskLabel(mask);\n      }\n\n      /**\n       * Handles changes to the selection of canvas objects (masks),\n       * updates mask stroke and label display, and syncs mask list selection.\n       *\n       * @param {Array<Object>} selected - The currently selected objects (e.g. [mask] or []).\n       * @private\n       */\n    }, {\n      key: \"_onSelectionChanged\",\n      value: function _onSelectionChanged(selected) {\n        var _this13 = this;\n        var selectedMask = (selected || []).find(function (o) {\n          return o.maskId;\n        });\n        var masks = this.canvas.getObjects().filter(function (o) {\n          return o.maskId;\n        });\n        masks.forEach(function (m) {\n          if (m !== selectedMask) {\n            if (m.__label) {\n              try {\n                _this13.canvas.remove(m.__label);\n              } catch (e) {}\n              delete m.__label;\n            }\n            m.set({\n              stroke: '#ccc',\n              strokeWidth: 1\n            });\n          } else {\n            m.set({\n              stroke: '#ff0000',\n              strokeWidth: 1\n            });\n          }\n        });\n        if (selectedMask) this._showLabelForMask(selectedMask);\n        this._updateMaskListSelection(selectedMask);\n        this.canvas.renderAll();\n        this._updateUI();\n      }\n\n      /**\n       * Updates the mask list in the DOM to reflect the current masks on the canvas.\n       * Each list entry becomes a clickable element for mask selection.\n       * @private\n       */\n    }, {\n      key: \"_updateMaskList\",\n      value: function _updateMaskList() {\n        var _this14 = this;\n        var listEl = document.getElementById(this.elements.maskList);\n        if (!listEl) return;\n        listEl.innerHTML = '';\n        var masks = this.canvas.getObjects().filter(function (o) {\n          return o.maskId;\n        });\n        masks.forEach(function (mask) {\n          var li = document.createElement('li');\n          li.className = 'list-group-item mask-item';\n          li.textContent = mask.maskName;\n          li.onclick = function () {\n            _this14.canvas.setActiveObject(mask);\n            _this14._onSelectionChanged([mask]);\n          };\n          listEl.appendChild(li);\n        });\n      }\n\n      /**\n       * Updates the visual selection (CSS 'active') state for the mask list in the DOM.\n       * \n       * @param {Object|null} selectedMask - The currently selected mask, or null if none selected.\n       * @private\n       */\n    }, {\n      key: \"_updateMaskListSelection\",\n      value: function _updateMaskListSelection(selectedMask) {\n        var listEl = document.getElementById(this.elements.maskList);\n        if (!listEl) return;\n        var items = listEl.querySelectorAll('.mask-item');\n        items.forEach(function (item) {\n          var isSelected = !!selectedMask && item.textContent === selectedMask.maskName;\n          item.classList.toggle('active', isSelected);\n        });\n      }\n\n      /**\n       * Merges current masks into the image: exports a masked/cropped image, removes all masks, and re-imports the merged image.\n       * Will not run if no original image or no masks exist.\n       * @async\n       * @returns {Promise<void>} Resolves when merge and load are complete.\n       */\n    }, {\n      key: \"merge\",\n      value: (function () {\n        var _merge = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee2() {\n          var masks, merged, _t;\n          return _regenerator().w(function (_context2) {\n            while (1) switch (_context2.p = _context2.n) {\n              case 0:\n                if (this.originalImage) {\n                  _context2.n = 1;\n                  break;\n                }\n                return _context2.a(2);\n              case 1:\n                masks = this.canvas.getObjects().filter(function (o) {\n                  return o.maskId;\n                });\n                if (masks.length) {\n                  _context2.n = 2;\n                  break;\n                }\n                return _context2.a(2);\n              case 2:\n                this.canvas.discardActiveObject();\n                this.canvas.renderAll();\n                _context2.p = 3;\n                _context2.n = 4;\n                return this.getImageBase64({\n                  exportImageArea: true,\n                  multiplier: this.options.exportMultiplier\n                });\n              case 4:\n                merged = _context2.v;\n                this.removeAllMasks();\n                _context2.n = 5;\n                return this.loadImage(merged);\n              case 5:\n                this.saveState();\n                _context2.n = 7;\n                break;\n              case 6:\n                _context2.p = 6;\n                _t = _context2.v;\n                console.error('merge error', _t);\n                if (this.canvasEl) this.canvasEl.style.visibility = '';\n              case 7:\n                return _context2.a(2);\n            }\n          }, _callee2, this, [[3, 6]]);\n        }));\n        function merge() {\n          return _merge.apply(this, arguments);\n        }\n        return merge;\n      }()\n      /**\n       * Triggers a JPEG image download of the current canvas (image plus masks if configured).\n       * The image area and multiplier are controlled by options.\n       * @param {string} [fileName=this.options.defaultDownloadFileName] - Desired download file name.\n       */\n      )\n    }, {\n      key: \"downloadImage\",\n      value: function downloadImage() {\n        var fileName = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : this.options.defaultDownloadFileName;\n        if (!this.originalImage) return;\n        var exportImageArea = this.options.exportImageAreaByDefault;\n        this.getImageBase64({\n          exportImageArea: exportImageArea,\n          multiplier: this.options.exportMultiplier\n        }).then(function (base64) {\n          var link = document.createElement('a');\n          link.download = fileName;\n          link.href = base64;\n          document.body.appendChild(link);\n          link.click();\n          document.body.removeChild(link);\n        }).catch(function (err) {\n          return console.error('download error', err);\n        });\n      }\n\n      /**\n       * Exports the image as a Base64-encoded JPEG.\n       * Can export either the original, or the current view including masks (clipped/cropped).\n       * Will restore masks' state after temporary modifications for export.\n       * @async\n       * @param {Object} [opts={}] - Export options.\n       * @param {boolean} [opts.exportImageArea] - If true, exports only the image bounding area with masks cropped and blended.\n       * @param {number} [opts.multiplier=1] - Scaling multiplier for output (resolution).\n       * @returns {Promise<string>} Promise resolving to a JPEG image data URL.\n       * @throws {Error} If there is no image loaded.\n       */\n    }, {\n      key: \"getImageBase64\",\n      value: (function () {\n        var _getImageBase = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee3() {\n          var _this15 = this;\n          var opts,\n            exportImageArea,\n            multiplier,\n            imgEl,\n            w,\n            h,\n            oc,\n            ctx,\n            masks,\n            masksBackup,\n            imgBr,\n            sx,\n            sy,\n            sw,\n            sh,\n            finalBase64,\n            _args3 = arguments;\n          return _regenerator().w(function (_context3) {\n            while (1) switch (_context3.n) {\n              case 0:\n                opts = _args3.length > 0 && _args3[0] !== undefined ? _args3[0] : {};\n                if (this.originalImage) {\n                  _context3.n = 1;\n                  break;\n                }\n                throw new Error('No image loaded');\n              case 1:\n                exportImageArea = typeof opts.exportImageArea === 'boolean' ? opts.exportImageArea : this.options.exportImageAreaByDefault;\n                multiplier = opts.multiplier || this.options.exportMultiplier || 1;\n                if (exportImageArea) {\n                  _context3.n = 3;\n                  break;\n                }\n                // Export original image pixels\n                imgEl = this.originalImage.getElement ? this.originalImage.getElement() : this.originalImage._element || null;\n                if (imgEl) {\n                  _context3.n = 2;\n                  break;\n                }\n                return _context3.a(2, this.canvas.toDataURL({\n                  format: 'jpeg',\n                  quality: this.options.downsampleQuality,\n                  multiplier: multiplier\n                }));\n              case 2:\n                w = this.originalImage.width;\n                h = this.originalImage.height;\n                oc = document.createElement('canvas');\n                oc.width = w;\n                oc.height = h;\n                ctx = oc.getContext('2d');\n                ctx.drawImage(imgEl, 0, 0, w, h);\n                return _context3.a(2, oc.toDataURL('image/jpeg', this.options.downsampleQuality));\n              case 3:\n                // Export current scaled image area (masks clipped)\n                masks = this.canvas.getObjects().filter(function (o) {\n                  return o.maskId;\n                });\n                masksBackup = masks.map(function (m) {\n                  return {\n                    obj: m,\n                    opacity: m.opacity,\n                    fill: m.fill,\n                    strokeWidth: m.strokeWidth,\n                    stroke: m.stroke,\n                    selectable: m.selectable,\n                    lockRotation: m.lockRotation\n                  };\n                }); // Remove labels, deselect\n                masks.forEach(function (m) {\n                  return _this15._removeLabelForMask(m);\n                });\n                this.canvas.discardActiveObject();\n                this.canvas.renderAll();\n\n                // Set masks to opaque black no border\n                masks.forEach(function (m) {\n                  m.set({\n                    opacity: 1,\n                    fill: '#000000',\n                    strokeWidth: 0,\n                    stroke: null,\n                    selectable: false\n                  });\n                  m.setCoords();\n                });\n                this.canvas.renderAll();\n\n                // Compute integer bounding box for image\n                this.originalImage.setCoords();\n                imgBr = this.originalImage.getBoundingRect(true, true);\n                sx = Math.max(0, Math.round(imgBr.left));\n                sy = Math.max(0, Math.round(imgBr.top));\n                sw = Math.max(1, Math.round(imgBr.width));\n                sh = Math.max(1, Math.round(imgBr.height)); // Crop precisely in offscreen canvas\n                _context3.n = 4;\n                return new Promise(function (resolve, reject) {\n                  try {\n                    var fullDataUrl = _this15.canvas.toDataURL({\n                      format: 'jpeg',\n                      quality: _this15.options.downsampleQuality,\n                      multiplier: multiplier\n                    });\n                    var img = new Image();\n                    img.onload = function () {\n                      try {\n                        var sxM = Math.round(sx * multiplier);\n                        var syM = Math.round(sy * multiplier);\n                        var swM = Math.round(sw * multiplier);\n                        var shM = Math.round(sh * multiplier);\n                        var _oc = document.createElement('canvas');\n                        _oc.width = swM;\n                        _oc.height = shM;\n                        var _ctx = _oc.getContext('2d');\n                        _ctx.drawImage(img, sxM, syM, swM, shM, 0, 0, swM, shM);\n                        var out = _oc.toDataURL('image/jpeg', _this15.options.downsampleQuality);\n                        resolve(out);\n                      } catch (e) {\n                        reject(e);\n                      }\n                    };\n                    img.onerror = reject;\n                    img.src = fullDataUrl;\n                  } catch (e) {\n                    reject(e);\n                  }\n                });\n              case 4:\n                finalBase64 = _context3.v;\n                // Restore masks\n                masksBackup.forEach(function (b) {\n                  try {\n                    b.obj.set({\n                      opacity: b.opacity,\n                      fill: b.fill,\n                      strokeWidth: b.strokeWidth,\n                      stroke: b.stroke,\n                      selectable: b.selectable,\n                      lockRotation: b.lockRotation\n                    });\n                    b.obj.setCoords();\n                  } catch (e) {}\n                });\n                this.canvas.renderAll();\n                return _context3.a(2, finalBase64);\n            }\n          }, _callee3, this);\n        }));\n        function getImageBase64() {\n          return _getImageBase.apply(this, arguments);\n        }\n        return getImageBase64;\n      }()\n      /**\n       * Exports the current canvas (with or without masks) as a File object.\n       * Allows you to choose whether to merge masks and specify file type (jpeg/png/webp).\n       * \n       * @async\n       * @param {Object} [opts={}] - Export options.\n       * @param {boolean} [opts.mergeMask=true] - If true, export image area with masks merged; if false, export the plain image without masks.\n       * @param {string} [opts.fileType='jpeg'] - Output file type ('jpeg' | 'png' | 'webp'). Defaults to 'jpeg' on invalid input.\n       * @param {number} [opts.quality=0.92] - Image quality for lossy types (0-1, default based on options.downsampleQuality).\n       * @param {number} [opts.multiplier=1] - Output resolution multiplier.\n       * @param {string} [opts.fileName] - Optional file name (only used for download).\n       * @returns {Promise<File>} Resolves with the exported image as a File object.\n       * \n       * @example\n       *   const file = await this.exportImageFile({ mergeMask: false, fileType: 'png' });\n       */\n      )\n    }, {\n      key: \"exportImageFile\",\n      value: (function () {\n        var _exportImageFile = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee4() {\n          var _this$options$downsam, _this$options$exportM, _this$options$default;\n          var opts,\n            _opts$mergeMask,\n            mergeMask,\n            _opts$fileType,\n            fileType,\n            _opts$quality,\n            quality,\n            _opts$multiplier,\n            multiplier,\n            _opts$fileName,\n            fileName,\n            typeMapping,\n            safeFileType,\n            base64,\n            imageDataUrl,\n            bstr,\n            mime,\n            n,\n            u8arr,\n            file,\n            _args4 = arguments;\n          return _regenerator().w(function (_context4) {\n            while (1) switch (_context4.n) {\n              case 0:\n                opts = _args4.length > 0 && _args4[0] !== undefined ? _args4[0] : {};\n                if (this.originalImage) {\n                  _context4.n = 1;\n                  break;\n                }\n                throw new Error('No image loaded');\n              case 1:\n                _opts$mergeMask = opts.mergeMask, mergeMask = _opts$mergeMask === void 0 ? true : _opts$mergeMask, _opts$fileType = opts.fileType, fileType = _opts$fileType === void 0 ? 'jpeg' : _opts$fileType, _opts$quality = opts.quality, quality = _opts$quality === void 0 ? (_this$options$downsam = this.options.downsampleQuality) !== null && _this$options$downsam !== void 0 ? _this$options$downsam : 0.92 : _opts$quality, _opts$multiplier = opts.multiplier, multiplier = _opts$multiplier === void 0 ? (_this$options$exportM = this.options.exportMultiplier) !== null && _this$options$exportM !== void 0 ? _this$options$exportM : 1 : _opts$multiplier, _opts$fileName = opts.fileName, fileName = _opts$fileName === void 0 ? (_this$options$default = this.options.defaultDownloadFileName) !== null && _this$options$default !== void 0 ? _this$options$default : 'exported_image.jpg' : _opts$fileName;\n                typeMapping = {\n                  'jpeg': 'jpeg',\n                  'jpg': 'jpeg',\n                  'image/jpeg': 'jpeg',\n                  'png': 'png',\n                  'image/png': 'png',\n                  'webp': 'webp',\n                  'image/webp': 'webp'\n                };\n                safeFileType = typeMapping[String(fileType).toLowerCase()] || 'jpeg'; // Get Base64\n                if (!mergeMask) {\n                  _context4.n = 3;\n                  break;\n                }\n                _context4.n = 2;\n                return this.getImageBase64({\n                  exportImageArea: true,\n                  multiplier: multiplier\n                });\n              case 2:\n                base64 = _context4.v;\n                _context4.n = 5;\n                break;\n              case 3:\n                _context4.n = 4;\n                return this.getImageBase64({\n                  exportImageArea: false,\n                  multiplier: multiplier\n                });\n              case 4:\n                base64 = _context4.v;\n              case 5:\n                // Convert to the required image format\n                imageDataUrl = base64;\n                if (imageDataUrl.startsWith(\"data:image/\".concat(safeFileType))) {\n                  _context4.n = 7;\n                  break;\n                }\n                _context4.n = 6;\n                return new Promise(function (resolve, reject) {\n                  var img = new window.Image();\n                  img.crossOrigin = \"Anonymous\";\n                  img.onload = function () {\n                    try {\n                      var oc = document.createElement('canvas');\n                      oc.width = img.width;\n                      oc.height = img.height;\n                      var ctx = oc.getContext('2d');\n                      ctx.drawImage(img, 0, 0);\n                      var durl = oc.toDataURL(\"image/\".concat(safeFileType), quality);\n                      resolve(durl);\n                    } catch (e) {\n                      reject(e);\n                    }\n                  };\n                  img.onerror = reject;\n                  img.src = base64;\n                });\n              case 6:\n                imageDataUrl = _context4.v;\n              case 7:\n                // Convert DataURL to Blob and then to File\n                bstr = atob(imageDataUrl.split(',')[1]);\n                mime = \"image/\".concat(safeFileType);\n                n = bstr.length;\n                u8arr = new Uint8Array(n);\n                while (n--) {\n                  u8arr[n] = bstr.charCodeAt(n);\n                }\n                file = new File([u8arr], fileName, {\n                  type: mime\n                });\n                return _context4.a(2, file);\n            }\n          }, _callee4, this);\n        }));\n        function exportImageFile() {\n          return _exportImageFile.apply(this, arguments);\n        }\n        return exportImageFile;\n      }()\n      /**\n       * Enter crop mode: create a resizable/movable selection rect on top of the image.\n       * @public\n       */\n      )\n    }, {\n      key: \"enterCropMode\",\n      value: function enterCropMode() {\n        var _this16 = this;\n        if (!this.canvas || !this.originalImage || this._cropMode) return;\n        if (!this.isImageLoaded()) return;\n        this._cropMode = true;\n\n        // Disable canvas group selection to avoid accidental group selection while cropping\n        this._prevSelectionSetting = this.canvas.selection;\n        this.canvas.selection = false;\n\n        // Make sure no active object\n        this.canvas.discardActiveObject();\n\n        // Create initial crop rect centered on the image bounding box\n        this.originalImage.setCoords();\n        var imgBr = this.originalImage.getBoundingRect(true, true);\n        // Provide small inset so user can see a margin\n        var padding = this.options.crop && this.options.crop.padding ? this.options.crop.padding : 10;\n        var left = Math.max(0, Math.floor(imgBr.left + padding));\n        var top = Math.max(0, Math.floor(imgBr.top + padding));\n        var width = Math.min(this.options.crop.minWidth || 50, Math.floor(imgBr.width - padding * 2));\n        var height = Math.min(this.options.crop.minHeight || 50, Math.floor(imgBr.height - padding * 2));\n\n        // Visual style: translucent fill + dashed stroke\n        var cropRect = new fabric.Rect({\n          left: left,\n          top: top,\n          width: width,\n          height: height,\n          fill: 'rgba(0,0,0,0.12)',\n          stroke: '#00aaff',\n          strokeDashArray: [6, 4],\n          strokeWidth: 1,\n          strokeUniform: true,\n          selectable: true,\n          hasRotatingPoint: !!(this.options.crop && this.options.crop.allowRotationOfCropRect),\n          lockRotation: !(this.options.crop && this.options.crop.allowRotationOfCropRect),\n          cornerSize: 8,\n          objectCaching: false,\n          originX: 'left',\n          originY: 'top'\n        });\n\n        // Ensure the crop rect is above everything\n        this.canvas.add(cropRect);\n        cropRect.isCropRect = true;\n        this.canvas.bringToFront(cropRect);\n        this.canvas.setActiveObject(cropRect);\n\n        // Keep reference\n        this._cropRect = cropRect;\n\n        // While in crop mode: we want only the cropRect to be interactive\n        // but still allow moving/scaling it. To be safe, set other objects evented=false temporarily.\n        this._cropPrevEvented = [];\n        this.canvas.getObjects().forEach(function (o) {\n          if (o !== cropRect) {\n            _this16._cropPrevEvented.push({\n              obj: o,\n              evented: o.evented,\n              selectable: o.selectable\n            });\n            try {\n              o.evented = false;\n              o.selectable = false;\n            } catch (e) {/* ignore */}\n          }\n        });\n\n        // When the crop rect changes, re-render\n        var onModified = function onModified() {\n          try {\n            cropRect.setCoords();\n            _this16.canvas.requestRenderAll();\n          } catch (e) {}\n        };\n        cropRect.on('modified', onModified);\n        cropRect.on('moving', onModified);\n        cropRect.on('scaling', onModified);\n\n        // Keep handlers to remove later\n        this._cropHandlers.push({\n          target: cropRect,\n          handlers: [{\n            evt: 'modified',\n            fn: onModified\n          }, {\n            evt: 'moving',\n            fn: onModified\n          }, {\n            evt: 'scaling',\n            fn: onModified\n          }]\n        });\n        this._updateUI();\n        this.canvas.renderAll();\n      }\n\n      /**\n       * Cancel crop mode and remove the temporary selection rect.\n       * @public\n       */\n    }, {\n      key: \"cancelCrop\",\n      value: function cancelCrop() {\n        if (!this.canvas || !this._cropMode) return;\n        // Remove handlers if any and remove object\n        if (this._cropRect) {\n          try {\n            if (this._cropHandlers && this._cropHandlers.length) {\n              this._cropHandlers.forEach(function (h) {\n                h.handlers.forEach(function (rec) {\n                  return h.target.off(rec.evt, rec.fn);\n                });\n              });\n            }\n          } catch (e) {/* ignore */}\n          try {\n            this.canvas.remove(this._cropRect);\n          } catch (e) {}\n          this._cropRect = null;\n        }\n        // restore evented/selectable flags\n        if (Array.isArray(this._cropPrevEvented)) {\n          this._cropPrevEvented.forEach(function (i) {\n            try {\n              i.obj.evented = i.evented;\n              i.obj.selectable = i.selectable;\n            } catch (e) {}\n          });\n        }\n        this._cropPrevEvented = null;\n        this._cropHandlers = [];\n        this._cropMode = false;\n        // restore selection setting\n        this.canvas.selection = !!this._prevSelectionSetting;\n        this._prevSelectionSetting = undefined;\n        this.canvas.discardActiveObject();\n        this._updateUI();\n        this.canvas.renderAll();\n      }\n\n      /**\n       * Apply the current crop rectangle.\n       * remove all masks and export canvas snapshot and crop via offscreen canvas\n       * @public\n       */\n    }, {\n      key: \"applyCrop\",\n      value: (function () {\n        var _applyCrop = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee5() {\n          var _this17 = this;\n          var rectBounds, sx, sy, sw, sh, beforeJson, jsonObj, masks, croppedBase64, fullDataUrl, afterJson, jsonObj2, _self, cmd, _t2, _t3;\n          return _regenerator().w(function (_context5) {\n            while (1) switch (_context5.p = _context5.n) {\n              case 0:\n                if (!(!this.canvas || !this._cropMode || !this._cropRect)) {\n                  _context5.n = 1;\n                  break;\n                }\n                return _context5.a(2);\n              case 1:\n                // Ensure crop rect coords are fresh\n                this._cropRect.setCoords();\n                rectBounds = this._cropRect.getBoundingRect(true, true); // Compute integer crop region clamped to canvas\n                sx = Math.max(0, Math.round(rectBounds.left));\n                sy = Math.max(0, Math.round(rectBounds.top));\n                sw = Math.max(1, Math.round(Math.min(rectBounds.width, this.canvas.getWidth() - sx)));\n                sh = Math.max(1, Math.round(Math.min(rectBounds.height, this.canvas.getHeight() - sy))); // Include isCropRect in toJSON whitelist so we can detect and filter them out.\n                beforeJson = null;\n                try {\n                  jsonObj = this.canvas.toJSON(['maskId', 'maskName', 'isCropRect']);\n                  if (Array.isArray(jsonObj.objects)) {\n                    jsonObj.objects = jsonObj.objects.filter(function (o) {\n                      return !o.isCropRect;\n                    });\n                  }\n                  beforeJson = JSON.stringify(jsonObj);\n                } catch (e) {\n                  console.warn('applyCrop: could not serialize before state', e);\n                  beforeJson = null;\n                }\n\n                // Remove ALL un-merged masks so they won't be baked into exported pixels\n                try {\n                  masks = this.canvas.getObjects().filter(function (o) {\n                    return o.maskId;\n                  });\n                  if (masks && masks.length) {\n                    masks.forEach(function (m) {\n                      try {\n                        _this17._removeLabelForMask(m);\n                        _this17.canvas.remove(m);\n                      } catch (err) {\n                        console.warn('applyCrop: failed to remove mask', err);\n                      }\n                    });\n                    this.canvas.discardActiveObject();\n                    this.canvas.renderAll();\n                  }\n                } catch (e) {\n                  console.warn('applyCrop: error while removing masks', e);\n                }\n                try {\n                  if (this._cropRect) {\n                    try {\n                      if (this._cropHandlers && this._cropHandlers.length) {\n                        this._cropHandlers.forEach(function (h) {\n                          h.handlers.forEach(function (rec) {\n                            return h.target.off(rec.evt, rec.fn);\n                          });\n                        });\n                      }\n                    } catch (e) {/* ignore */}\n                    try {\n                      this.canvas.remove(this._cropRect);\n                    } catch (e) {/* ignore */}\n                    this._cropRect = null;\n                  }\n                } catch (e) {/* ignore */}\n\n                // End crop mode\n                this._cropMode = false;\n                this.canvas.selection = !!this._prevSelectionSetting;\n                this._prevSelectionSetting = undefined;\n\n                // Export full canvas and crop on offscreen canvas\n                _context5.p = 2;\n                fullDataUrl = this.canvas.toDataURL({\n                  format: 'jpeg',\n                  quality: this.options.downsampleQuality || 0.92,\n                  multiplier: 1\n                });\n                _context5.n = 3;\n                return new Promise(function (resolve, reject) {\n                  var img = new Image();\n                  img.onload = function () {\n                    try {\n                      var oc = document.createElement('canvas');\n                      oc.width = sw;\n                      oc.height = sh;\n                      var ctx = oc.getContext('2d');\n                      ctx.drawImage(img, sx, sy, sw, sh, 0, 0, sw, sh);\n                      var out = oc.toDataURL('image/jpeg', _this17.options.downsampleQuality || 0.92);\n                      resolve(out);\n                    } catch (err) {\n                      reject(err);\n                    }\n                  };\n                  img.onerror = function (e) {\n                    return reject(e);\n                  };\n                  img.src = fullDataUrl;\n                });\n              case 3:\n                croppedBase64 = _context5.v;\n                _context5.n = 5;\n                break;\n              case 4:\n                _context5.p = 4;\n                _t2 = _context5.v;\n                console.error('applyCrop: failed to create cropped image', _t2);\n                this._updateUI();\n                return _context5.a(2);\n              case 5:\n                _context5.p = 5;\n                _context5.n = 6;\n                return this.loadImage(croppedBase64);\n              case 6:\n                _context5.n = 8;\n                break;\n              case 7:\n                _context5.p = 7;\n                _t3 = _context5.v;\n                console.error('applyCrop: loadImage(croppedBase64) failed', _t3);\n                this._updateUI();\n                return _context5.a(2);\n              case 8:\n                // Create \"after\" snapshot (also exclude crop rect if any) and push history command\n                afterJson = null;\n                try {\n                  jsonObj2 = this.canvas.toJSON(['maskId', 'maskName', 'isCropRect']);\n                  if (Array.isArray(jsonObj2.objects)) {\n                    jsonObj2.objects = jsonObj2.objects.filter(function (o) {\n                      return !o.isCropRect;\n                    });\n                  }\n                  afterJson = JSON.stringify(jsonObj2);\n                } catch (e) {\n                  console.warn('applyCrop: failed to serialize after state', e);\n                  afterJson = null;\n                }\n                try {\n                  _self = this;\n                  cmd = new Command(function () {\n                    if (afterJson) _self.loadFromState(afterJson);\n                  }, function () {\n                    if (beforeJson) _self.loadFromState(beforeJson);\n                  });\n                  if (!this.historyManager) this.historyManager = new HistoryManager(this.maxHistorySize || 50);\n\n                  // trim future redo history\n                  if (this.historyManager.currentIndex < this.historyManager.history.length - 1) {\n                    this.historyManager.history = this.historyManager.history.slice(0, this.historyManager.currentIndex + 1);\n                  }\n                  this.historyManager.history.push(cmd);\n                  if (this.historyManager.history.length > this.historyManager.maxSize) {\n                    this.historyManager.history.shift();\n                  } else {\n                    this.historyManager.currentIndex++;\n                  }\n                } catch (e) {\n                  console.warn('applyCrop: failed to push history command', e);\n                }\n\n                // Final UI update\n                this._updateUI();\n                this.canvas.renderAll();\n              case 9:\n                return _context5.a(2);\n            }\n          }, _callee5, this, [[5, 7], [2, 4]]);\n        }));\n        function applyCrop() {\n          return _applyCrop.apply(this, arguments);\n        }\n        return applyCrop;\n      }()\n      /* ---------- Misc / UI ---------- */\n      /**\n       * Updates the scale input field in the UI to reflect the current scale.\n       * Sets the value (as percentage) if the element is present.\n       * @private\n       */\n      )\n    }, {\n      key: \"_updateInputs\",\n      value: function _updateInputs() {\n        var scaleEl = document.getElementById(this.elements.scaleRate);\n        if (scaleEl) scaleEl.value = Math.round(this.currentScale * 100);\n      }\n\n      /**\n       * Updates the enabled/disabled state of various UI controls (buttons)\n       * based on the current application state (image/mask presence, animation, etc).\n       * @private\n       */\n    }, {\n      key: \"_updateUI\",\n      value: function _updateUI() {\n        var _this$historyManager, _this$historyManager2;\n        var hasImg = !!this.originalImage;\n        var masks = hasImg ? this.canvas.getObjects().filter(function (o) {\n          return o.maskId;\n        }) : [];\n        var hasMasks = masks.length > 0;\n        var active = this.canvas.getActiveObject();\n        var hasSelectedMask = active && active.maskId;\n        var isDefault = this.currentScale === 1 && this.currentRotation === 0;\n        var canUndo = (_this$historyManager = this.historyManager) === null || _this$historyManager === void 0 ? void 0 : _this$historyManager.canUndo();\n        var canRedo = (_this$historyManager2 = this.historyManager) === null || _this$historyManager2 === void 0 ? void 0 : _this$historyManager2.canRedo();\n        var inCrop = !!this._cropMode;\n        if (inCrop) {\n          // iterate all element keys and disable unless key is applyCropBtn or cancelCropBtn\n          for (var _i = 0, _Object$keys = Object.keys(this.elements || {}); _i < _Object$keys.length; _i++) {\n            var k = _Object$keys[_i];\n            var el = document.getElementById(this.elements[k]);\n            if (!el) continue;\n            if (k === 'applyCropBtn' || k === 'cancelCropBtn') {\n              el.disabled = false;\n            } else {\n              el.disabled = true;\n            }\n          }\n          return;\n        }\n        this._setDisabled('zoomInBtn', !hasImg || this.isAnimating || this.currentScale >= this.options.maxScale);\n        this._setDisabled('zoomOutBtn', !hasImg || this.isAnimating || this.currentScale <= this.options.minScale);\n        this._setDisabled('rotateLeftBtn', !hasImg || this.isAnimating);\n        this._setDisabled('rotateRightBtn', !hasImg || this.isAnimating);\n        this._setDisabled('addMaskBtn', !hasImg || this.isAnimating);\n        this._setDisabled('removeMaskBtn', !hasSelectedMask || this.isAnimating);\n        this._setDisabled('removeAllMasksBtn', !hasMasks || this.isAnimating);\n        this._setDisabled('mergeBtn', !hasImg || !hasMasks || this.isAnimating);\n        this._setDisabled('downloadBtn', !hasImg || this.isAnimating);\n        this._setDisabled('resetBtn', !hasImg || isDefault || this.isAnimating);\n        this._setDisabled('undoBtn', !hasImg || this.isAnimating || !canUndo);\n        this._setDisabled('redoBtn', !hasImg || this.isAnimating || !canRedo);\n        this._setDisabled('cropBtn', !hasImg || this.isAnimating);\n        this._setDisabled('applyCropBtn', true);\n        this._setDisabled('cancelCropBtn', true);\n      }\n\n      /**\n       * Enables or disables a specific UI element (typically a button) by its key.\n       * \n       * @param {string} key - Key of the element in this.elements (e.g. 'zoomInBtn').\n       * @param {boolean} disabled - If true, disables the element; otherwise enables.\n       * @private\n       */\n    }, {\n      key: \"_setDisabled\",\n      value: function _setDisabled(key, disabled) {\n        var el = document.getElementById(this.elements[key]);\n        if (el) el.disabled = !!disabled;\n      }\n\n      /**\n       * Automatically display and hide placeholders and containers based on the current image content\n       * @private\n       */\n    }, {\n      key: \"_updatePlaceholderStatus\",\n      value: function _updatePlaceholderStatus() {\n        if (!this.options.showPlaceholder) return;\n        this._setPlaceholderVisible(!this.originalImage);\n      }\n\n      /**\n       * Controls the display/hiding of the Placeholder and Canvas container.\n       * @param {boolean} show - true displays the placeholder, false displays the canvas container\n       * @private\n       */\n    }, {\n      key: \"_setPlaceholderVisible\",\n      value: function _setPlaceholderVisible(show) {\n        if (!this.placeholderEl) return;\n        if (show) {\n          this.placeholderEl.classList.remove('d-none');\n          this.placeholderEl.classList.add('d-flex');\n          this.containerEl.classList.add('d-none');\n        } else {\n          this.placeholderEl.classList.remove('d-flex');\n          this.placeholderEl.classList.add('d-none');\n          this.containerEl.classList.remove('d-none');\n        }\n      }\n\n      /**\n       * Cleans up and disposes of the canvas and related references.\n       * Call this method to free memory and remove canvas listeners when the editor is no longer needed.\n       * @public\n       */\n    }, {\n      key: \"dispose\",\n      value: function dispose() {\n        var _this18 = this;\n        // Remove bound DOM event listeners\n        try {\n          var _loop = function _loop() {\n            var handlers = _this18._boundHandlers[key] || [];\n            var el = document.getElementById(_this18.elements[key]);\n            if (!el) return 1; // continue\n            handlers.forEach(function (h) {\n              try {\n                el.removeEventListener(h.event, h.handler);\n              } catch (e) {}\n            });\n          };\n          for (var key in this._boundHandlers || {}) {\n            if (_loop()) continue;\n          }\n        } catch (e) {}\n        if (this._cropRect) {\n          try {\n            this.canvas.remove(this._cropRect);\n          } catch (e) {}\n          this._cropRect = null;\n        }\n        if (this.canvas) {\n          try {\n            this.canvas.dispose();\n          } catch (e) {}\n          this.canvas = null;\n          this.canvasEl = null;\n          this.isImageLoadedToCanvas = false;\n        }\n        this._boundHandlers = {};\n      }\n    }]);\n  }();\n  /**\n   * A simple FIFO queue that guarantees animations are executed sequentially.\n   * @class AnimationQueue\n   */\n  var AnimationQueue = /*#__PURE__*/function () {\n    /**\n     * Creates a new AnimationQueue.\n     *\n     * @constructor\n     */\n    function AnimationQueue() {\n      _classCallCheck(this, AnimationQueue);\n      /**\n       * Internal queue holding animation descriptors.\n       * @type {Array<{fn: Function, resolve: Function, reject: Function}>}\n       */\n      this.queue = [];\n      /**\n       * Flag indicating whether an animation is currently running.\n       * @type {boolean}\n       */\n      this.running = false;\n    }\n\n    /**\n     * Adds an animation function to the queue.\n     *\n     * @param   {Function} animationFn  A function that returns a Promise or any await-able.\n     * @returns {Promise<*>}            A Promise that resolves/rejects with the animation result.\n     */\n    return _createClass(AnimationQueue, [{\n      key: \"add\",\n      value: (function () {\n        var _add = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee6(animationFn) {\n          var _this19 = this;\n          return _regenerator().w(function (_context6) {\n            while (1) switch (_context6.n) {\n              case 0:\n                return _context6.a(2, new Promise(function (resolve, reject) {\n                  // Push the animation into the queue.\n                  _this19.queue.push({\n                    fn: animationFn,\n                    resolve: resolve,\n                    reject: reject\n                  });\n                  // Start processing if it's not already running.\n                  if (!_this19.running) {\n                    _this19.processQueue();\n                  }\n                }));\n            }\n          }, _callee6);\n        }));\n        function add(_x2) {\n          return _add.apply(this, arguments);\n        }\n        return add;\n      }()\n      /**\n       * Internal helper that processes the animation queue sequentially until it is empty.\n       *\n       * @private\n       * @returns {Promise<void>}\n       */\n      )\n    }, {\n      key: \"processQueue\",\n      value: (function () {\n        var _processQueue = _asyncToGenerator(/*#__PURE__*/_regenerator().m(function _callee7() {\n          var _this$queue$shift, fn, resolve, reject, result, _t4;\n          return _regenerator().w(function (_context7) {\n            while (1) switch (_context7.p = _context7.n) {\n              case 0:\n                if (!(this.queue.length === 0)) {\n                  _context7.n = 1;\n                  break;\n                }\n                this.running = false;\n                return _context7.a(2);\n              case 1:\n                this.running = true;\n                _this$queue$shift = this.queue.shift(), fn = _this$queue$shift.fn, resolve = _this$queue$shift.resolve, reject = _this$queue$shift.reject;\n                _context7.p = 2;\n                _context7.n = 3;\n                return fn();\n              case 3:\n                result = _context7.v;\n                resolve(result);\n                _context7.n = 5;\n                break;\n              case 4:\n                _context7.p = 4;\n                _t4 = _context7.v;\n                reject(_t4);\n              case 5:\n                this.processQueue();\n              case 6:\n                return _context7.a(2);\n            }\n          }, _callee7, this, [[2, 4]]);\n        }));\n        function processQueue() {\n          return _processQueue.apply(this, arguments);\n        }\n        return processQueue;\n      }())\n    }]);\n  }();\n  /**\n   * Command object encapsulating an executable action and its corresponding undo operation.\n   * @class Command\n   */\n  var Command = /*#__PURE__*/_createClass(\n  /**\n   * @param {Function} execute  The function that performs the action.\n   * @param {Function} undo     The function that reverts the action.\n   */\n  function Command(execute, undo) {\n    _classCallCheck(this, Command);\n    /**\n     * Executes the command.\n     * @type {Function}\n     */\n    this.execute = execute;\n    /**\n     * Undoes the command.\n     * @type {Function}\n     */\n    this.undo = undo;\n  });\n  /**\n   * Manages a history of Command objects enabling undo/redo functionality.\n   * @class HistoryManager\n   */\n  var HistoryManager = /*#__PURE__*/function () {\n    /**\n     * @param {number} [maxSize=50]  Maximum number of commands to keep in history.\n     */\n    function HistoryManager() {\n      var maxSize = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : 50;\n      _classCallCheck(this, HistoryManager);\n      this.history = [];\n      this.currentIndex = -1;\n      this.maxSize = maxSize;\n    }\n\n    /**\n     * Executes a new command and pushes it onto the history stack.\n     * Truncates any \"future\" history when branching.\n     *\n     * @param {Command} command  The command to execute.\n     * @returns {void}\n     */\n    return _createClass(HistoryManager, [{\n      key: \"execute\",\n      value: function execute(command) {\n        // Perform the command.\n        command.execute();\n\n        // Remove any commands that are ahead of the current index.\n        if (this.currentIndex < this.history.length - 1) {\n          this.history = this.history.slice(0, this.currentIndex + 1);\n        }\n\n        // Add the new command.\n        this.history.push(command);\n\n        // Maintain the max size of the buffer.\n        if (this.history.length > this.maxSize) {\n          this.history.shift(); // Remove the oldest command.\n        } else {\n          this.currentIndex++;\n        }\n      }\n\n      /**\n       * Checks whether an undo operation is possible.\n       *\n       * @returns {boolean}  True if undo can be performed.\n       */\n    }, {\n      key: \"canUndo\",\n      value: function canUndo() {\n        return this.currentIndex >= 0;\n      }\n\n      /**\n       * Checks whether a redo operation is possible.\n       *\n       * @returns {boolean}  True if redo can be performed.\n       */\n    }, {\n      key: \"canRedo\",\n      value: function canRedo() {\n        return this.currentIndex < this.history.length - 1;\n      }\n\n      /**\n       * Undoes the last executed command if possible.\n       *\n       * @returns {void}\n       */\n    }, {\n      key: \"undo\",\n      value: function undo() {\n        if (this.currentIndex >= 0) {\n          this.history[this.currentIndex].undo();\n          this.currentIndex--;\n        }\n      }\n\n      /**\n       * Redoes the next command in history if possible.\n       *\n       * @returns {void}\n       */\n    }, {\n      key: \"redo\",\n      value: function redo() {\n        if (this.currentIndex < this.history.length - 1) {\n          this.currentIndex++;\n          this.history[this.currentIndex].execute();\n        }\n      }\n    }]);\n  }();\n  return ImageEditor;\n});"],
  "mappings": "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",
  "names": ["require_image_editor", "__commonJSMin", "exports", "module", "_regenerator", "e", "t", "r", "n", "o", "i", "c", "Generator", "u", "_regeneratorDefine2", "f", "y", "G", "d", "a", "l", "p", "GeneratorFunction", "GeneratorFunctionPrototype", "asyncGeneratorStep", "_asyncToGenerator", "_next", "_throw", "ownKeys", "_objectSpread", "_defineProperty", "_toPropertyKey", "_classCallCheck", "_defineProperties", "_createClass", "_toPrimitive", "_typeof", "root", "factory", "ImageEditor", "options", "mask", "maskIndex", "AnimationQueue", "HistoryManager", "idMap", "defaults", "_this", "canvasEl", "ce", "initialW", "initialH", "cw", "ch", "_this2", "_document$getElementB", "inputEl", "rotLeftBtn", "rotRightBtn", "el", "step", "key", "event", "handler", "file", "_this3", "reader", "_loadImage", "_callee", "base64", "_this4", "imgEl", "loadSrc", "needResize", "ratio", "tw", "th", "_context", "fimg", "imgW", "imgH", "minW", "minH", "fitScale", "_cw", "_ch", "_cw2", "_ch2", "_fitScale", "loadImage", "_x", "dataURL", "res", "rej", "img", "w", "h", "quality", "oc", "ctx", "iw", "ih", "obj", "coords", "br", "originX", "originY", "refPoint", "dx", "dy", "containerW", "containerH", "newW", "newH", "factor", "_this5", "_this6", "targetAbs", "topLeft", "p1", "p2", "deg", "_this7", "degrees", "_this8", "center", "newTopLeft", "_this9", "err", "jsonString", "_this0", "json", "objs", "masks", "max", "m", "_this1", "activeObj", "jsonObj", "after", "before", "executedOnce", "cmd", "Command", "_this10", "config", "shapeType", "cfg", "firstOffset", "left", "top", "resolveValue", "val", "fallback", "percent", "_prev$top", "prev", "prevRight", "_prev$scaleX", "requiredW", "requiredH", "polyPoints", "pt", "normalStyle", "hoverStyle", "active", "_this11", "textObj", "txt", "textOptions", "_this12", "labels", "_this$options$maskLab", "tl", "vx", "vy", "dist", "ux", "uy", "offset", "px", "py", "selected", "_this13", "selectedMask", "_this14", "listEl", "li", "items", "item", "isSelected", "_merge", "_callee2", "merged", "_t", "_context2", "merge", "fileName", "exportImageArea", "link", "_getImageBase", "_callee3", "_this15", "opts", "multiplier", "masksBackup", "imgBr", "sx", "sy", "sw", "sh", "finalBase64", "_args3", "_context3", "resolve", "reject", "fullDataUrl", "sxM", "syM", "swM", "shM", "_oc", "_ctx", "out", "b", "getImageBase64", "_exportImageFile", "_callee4", "_this$options$downsam", "_this$options$exportM", "_this$options$default", "_opts$mergeMask", "mergeMask", "_opts$fileType", "fileType", "_opts$quality", "_opts$multiplier", "_opts$fileName", "typeMapping", "safeFileType", "imageDataUrl", "bstr", "mime", "u8arr", "_args4", "_context4", "durl", "exportImageFile", "_this16", "padding", "width", "height", "cropRect", "onModified", "rec", "_applyCrop", "_callee5", "_this17", "rectBounds", "beforeJson", "croppedBase64", "afterJson", "jsonObj2", "_self", "_t2", "_t3", "_context5", "applyCrop", "scaleEl", "_this$historyManager", "_this$historyManager2", "hasImg", "hasMasks", "hasSelectedMask", "isDefault", "canUndo", "canRedo", "inCrop", "_i", "_Object$keys", "k", "disabled", "show", "_this18", "_loop", "handlers", "_add", "_callee6", "animationFn", "_this19", "_context6", "add", "_x2", "_processQueue", "_callee7", "_this$queue$shift", "fn", "result", "_t4", "_context7", "processQueue", "execute", "undo", "maxSize", "command"]
}
